\section{Proof of Theorem~\protect\ref{thm:progress} (Progress)}
\label{sec:progress}

\newcommand{\NAT}[1]{{#1}^{\natural}}

Below we fix \(\Gamma\) to:
\begin{eqnarray*}
\Gamma&=&\Copy{f_1}{1}:\seq{\sigma}_{1,1} \to \TUNIT,\dots,\Copy{f_1}{\ell}:\seq{\sigma}_{1,\ell} \to \TUNIT,\dots, \\
      & &\Copy{f_n}{1}:\seq{\sigma}_{n,1} \to \TUNIT,\dots,\Copy{f_n}{\ell}:\seq{\sigma}_{n,\ell} \to \TUNIT.
\end{eqnarray*}
We define \(\NAT{\Gamma}\) by:
\begin{eqnarray*}
\NAT{\Gamma}&=&f_1:\NAT{(\seq{\sigma}_{1,1} \to \TUNIT)} \sqcup \cdots \sqcup 
                   \NAT{(\seq{\sigma}_{1,\ell} \to \TUNIT)},\dots, \\
&& f_n:\NAT{(\seq{\sigma}_{n,1} \to \TUNIT)} \sqcup \cdots \sqcup 
       \NAT{(\seq{\sigma}_{n,\ell} \to \TUNIT)} \\
\NAT{(b[\seq{P}])}&=&b[\seq{P}] \\
\NAT{(x:\sigma_1 \to \sigma_2)}&=&x:\NAT{\sigma_1} \to \NAT{\sigma_2} \\
\NAT{(\sigma_1 \times \dots \times \sigma_n)}&=&\NAT{\sigma_1} \itlub \cdots \itlub \NAT{\sigma_n}
\end{eqnarray*}

The idea of the proof is as follows. First, by the relative completeness 
(Theorem~\ref{th:rel-complete}), we obtain an abstracted SHP \(D_4\) of 
\(\mkSHP(D_1,s)\) such that \(\textit{main}\tuple{} \not\redswith{}{D_4} 
\FAIL\). We then construct an abstracted program \(D_3\) of \(D_1\) from 
\(D_4\) such that \(\textit{main}\tuple{} \not\redswith{s}{D_3} \FAIL\). 
Formally, we can prove the following lemma:
\begin{lemma}
\label{lem:main}
Suppose that
\begin{itemize}
\item \(s=b_1 \cdots b_{\ell}\), 
\item \(\T{}{\mkSHP(D_1,s)}{\Gamma}{D_4}\), and
\item \(\textit{main}\tuple{} \not\redswith{}{D_4} \FAIL\).
\end{itemize}
There exist \(D_3\) such that
\begin{itemize}
\item \(\T{}{D_1}{\NAT{\Gamma}}{D_3}\), and
\item \(\textit{main}\tuple{} \not\redswith{s}{D_3} \FAIL\).
\end{itemize}
\end{lemma}
Before we prove Lemma~\ref{lem:main} in Section~\ref{sec:main}, we 
prepare Lemmas~\ref{lem:weakening}, \ref{lem:merge}, and \ref{lem:conv} 
in Sections~\ref{sec:weakening}, \ref{sec:merge}, and \ref{sec:conv} 
respectively, which are used for the construction of \(D_3\).
%

\subsection{Proof of Lemma~\protect\ref{lem:weakening}}
\label{sec:weakening}
%lem:vweakeningaux
%lem:vweakening
%  lem:vweakeningaux
%lem:aweakening
%  lem:vweakening
%lem:weakening
%  lem:vweakening
%  lem:aweakening

The following lemma states that if \(e_1\) is an abstraction of \(e\) 
with some abstraction types \(\seq{\sigma}_1\), then we can construct 
more precise abstraction \(e_2\) by using abstraction types 
\(\seq{\sigma}_2\) that contain more predicates than \(\seq{\sigma}_1\).
%%%if \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{e}{\TUNIT}{e_1}\) is 
%%%derivable and given more precise abstraction types \(\seq{\sigma}_2\) 
%%%than \(\seq{\sigma}_1\), we can derive 
%%%\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{e}{\TUNIT}{e_2}\) for some 
%%%\(e_2\) such that \(e_1\) is an over-approximation of \(e_1\).
%íPÇ»ÇÈover-approximationÇ≈ÇÕÇ»Ç¢Ç™ê‡ñæÇµÇ…Ç≠Ç¢
\begin{lemma}
\label{lem:weakening}
%
If \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{e}{\TUNIT}{e_1}\) and 
\(\seq{\sigma}_1 \sqsubseteq \seq{\sigma}_2\), then there exists \(e_2\) 
such that 
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{e}{\TUNIT}{e_2}\),
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\), 
then \([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f\ \seq{v}\), 
then \([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} f\ \seq{v}\)
\end{itemize}
Here, \(\sigma \sqsubseteq \sigma'\) is defined by the following rules:
\infax
  {b[\seq{P}] \sqsubseteq b[\seq{Q},\seq{P},\seq{R}]}
\infrule
  {\sigma_1 \sqsubseteq \sigma'_1 \andalso
   \sigma_2 \sqsubseteq \sigma'_2}
  {(x\COL\sigma_1 \to \sigma_2) \sqsubseteq (x\COL\sigma'_1 \to \sigma'_2)}
%
\(\Pi_{\sigma_2}^{\sigma_1} e\) is defined by:
\begin{eqnarray*}
\Pi_{b[\seq{P}]}^{b[\seq{Q},\seq{P},\seq{R}]}e&=&\LETEQIN{\tuple{\seq{x},\seq{y},\seq{z}}}{e}\tuple{\seq{y}} \\
\Pi_{x:\sigma_2 \to \sigma_2'}^{x:\sigma_1 \to \sigma_1'}e&=&\lambda x.\Pi_{\sigma_2'}^{\sigma_1'} (e\ (\Pi_{\sigma_2}^{\sigma_1} x))
%\Pi_{b[\seq{P}]}^{b[\seq{Q},\seq{P},\seq{R}]}(\tuple{\seq{v}_1,\seq{v}_2,\seq{v}_3})&=&\tuple{\seq{v}_2} \\
%\Pi_{x:\seq{\sigma_2} \ra \sigma_2}^{x:\seq{\sigma_1} \ra \sigma_1}(f\ \seq{v})&=&f\ \Pi_{\seq{\sigma_2}}^{\seq{\sigma_1}}\seq{v}.
%\Pi_{\sigma_2}^{\sigma_1}(f\ \seq{v})&=&f\ \seq{v}.
\end{eqnarray*}
\end{lemma}
Before we prove Lemma~\protect\ref{lem:weakening} at the end of this 
section, we prepare Lemmas~\ref{lem:vweakeningaux}--\ref{lem:aweakening}.

\begin{lemma}
\label{lem:vweakeningaux}
Suppose that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{\sigma_1}{e_1}\) and
\item \(\sigma_1 \sqsubseteq \sigma_2\).
\end{itemize}
There exists \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{\sigma_2}{e_2}\),
\item \([\seq{v}/\seq{x}]e_1 \equiv \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2\).
\end{itemize}
\end{lemma}
\begin{proof}
If \(v\) is a base value, we can apply \rn{A-CoerceAdd} and \rn{A-CoerceRem}.
Otherwise, we can apply \rn{A-CoerceFun}.
\end{proof}

\begin{lemma}
\label{lem:vweakening}
Suppose that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{v}{\sigma_1}{e_1}\),
\item \(\seq{\sigma}_1 \sqsubseteq \seq{\sigma}_2\), and
\item \(\sigma_1 \sqsubseteq \sigma_2\).
\end{itemize}
There exists \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_2}{e_2}\),
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_1 \equiv \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2\).
\end{itemize}
\end{lemma}
\begin{proof}
We prove the lemma by induction on the derivation of \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{v}{\sigma_1}{e_1}\).
Case analysis on the last rule used:
\begin{itemize}
\item[] \rn{A-Base}
We have
\begin{itemize}
%\item \(v=x\) or \(v=c\),
\item \(\sigma_1=b[\lambda \nu.\nu=v]\) and
\item \(e_1=\TRUE\).
\end{itemize}
By \rn{A-Base}, we get 
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_1}{\TRUE}\).
By Lemma~\ref{lem:vweakeningaux}, we obtain some \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_2}{e_2}\) and
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_1=[\seq{v}/\seq{x}]\TRUE \equiv \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2\).
\end{itemize}

\item[] \rn{A-App}
\begin{itemize}
\item \(v=x\ \seq{v}\),
\item \((\NAT{\Gamma},\seq{x}:\seq{\sigma}_1)(x)=(y_1\COL\sigma_{11} \to \cdots \to y_k\COL\sigma_{1k} \to\sigma_1')\),
\item \(\sigma_1=[\seq{v}/\seq{y}]\sigma_1'\),
\item for each \(i\in\set{1,\ldots,k}\), \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1,y_1:\sigma_{11},\dots,y_{i-1}:\sigma_{1(i-1)}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_{1i}}{e_{1i}}\), and
\item \(e_1=\LETEQIN{\seq{y}}{\seq{e}_1}{x\ \seq{y}}\).
\end{itemize}
If \(x \in \DOM{\NAT{\Gamma}}\), then
\((\NAT{\Gamma},\seq{x}:\seq{\sigma}_2)(x)=(y_1\COL\sigma_{11} \to \cdots \to y_k\COL\sigma_{1k} \to \sigma_1')\).
By I.H. we obtain
\begin{itemize}
\item for each \(i\in\set{1,\ldots,k}\), \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2,y_1:\sigma_{11},\dots,y_{i-1}:\sigma_{1(i-1)}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_{1i}}{e_{2i}}\), and
\item \begin{eqnarray*}
&&[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x},\seq{v}_y/(y_1,\dots,y_{i-1})]e_{1i} \\
&\equiv& [\seq{v}/\seq{x},\seq{v}_y/(y_1,\dots,y_{i-1})]e_{2i}.
\end{eqnarray*}
\end{itemize}
By \rn{A-App}, we get
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_1}{\LETEQIN{\seq{y}}{\seq{e}_2}{x\ \seq{y}}}\).
%
By Lemma~\ref{lem:vweakeningaux}, we obtain some \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_2}{e_2}\) and
\item \([\seq{v}/\seq{x}]\LETEQIN{\seq{y}}{\seq{e}_2}{x\ \seq{y}} \equiv \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2\).
\end{itemize}
We obtain
\begin{eqnarray*}
[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_1
&=&[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]\LETEQIN{\seq{y}}{\seq{e}_1}{x\ \seq{y}} \\
&\equiv&[\seq{v}/\seq{x}]\LETEQIN{\seq{y}}{\seq{e}_2}{x\ \seq{y}} \\
&\equiv& \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2.
\end{eqnarray*}

Otherwise (\(x \in \set{\seq{x}}\)), 
\((\NAT{\Gamma},\seq{x}:\seq{\sigma}_2)(x)=(y_1\COL\sigma_{21} \to \cdots \to y_k\COL\sigma_{2k} \to\sigma_2')\).
By I.H., we get
\begin{itemize}
\item for each \(i\in\set{1,\ldots,k}\), \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2,y_1:\sigma_{21},\dots,y_{i-1}:\sigma_{2(i-1)}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_{2i}}{e_{2i}}\), and
\item 
\begin{eqnarray*}
&&[\Pi_{\seq{\sigma}_1,\sigma_{11},\dots,\sigma_{1(i-1)}}^{\seq{\sigma}_2,\sigma_{21},\dots,\sigma_{2(i-1)}}\seq{v}/(\seq{x},y_1,\dots,y_{i-1})]e_{1i} \\
&\equiv&\Pi_{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_{1i}}^{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_{2i}}[\seq{v}/(\seq{x},y_1,\dots,y_{i-1})]e_{2i}.
\end{eqnarray*}
\end{itemize}
By \rn{A-App}, we get
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{[\seq{v}/\seq{y}]\sigma_2'}{\LETEQIN{\seq{y}}{\seq{e}_2}{x\ \seq{y}}}\).
%
By Lemma~\ref{lem:vweakeningaux}, we obtain some \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_2}{e_2}\) and
\item \([\seq{v}/\seq{x}]\LETEQIN{\seq{y}}{\seq{e}_2}{x\ \seq{y}} \equiv \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2\).
\end{itemize}
We get
\begin{eqnarray*}
[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_1
&=&[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]\LETEQIN{\seq{y}}{\seq{e}_1}{x\ \seq{y}} \\
&\equiv& [\seq{v}/\seq{x}]\LETEQIN{\seq{y}}{\seq{e}_2}{x\ \seq{y}} \\
&\equiv& \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2.
\end{eqnarray*}

\item[] \rn{A-CoerceAdd}
\begin{itemize}
\item \(\sigma_1=b[\seq{Q},P]\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{v}{b[\seq{Q}]}{e_{11}}\),
\item \(\models  P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1,y:b[\seq{Q}]}\psi\),
\item \(\models \neg P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1,y\COL b[\seq{Q}]}\psi'\),
\item \(e_{12}=\PARB{(\ASSUME{\psi}{\TRUE})}{(\ASSUME{\psi'}{\FALSE})}\), and
\item \(e_1=\LETEQIN{y}{e_{11}}{\tuple{y,e_{12}}}\).
\end{itemize}
By I.H., we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{b[\seq{Q}]}{e_{21}}\) and
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_{11} \equiv [\seq{v}/\seq{x}]e_{21}\).
\end{itemize}
We obtain
\(\models  P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2,y:b[\seq{Q}]}[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{x}/\seq{x}]\psi\) and
\(\models \neg P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2,y\COL b[\seq{Q}]}[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{x}/\seq{x}]\psi'\).

Let \(e_{22}=\PARB{(\ASSUME{[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{x}/\seq{x}]\psi}{\TRUE})}{(\ASSUME{[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{x}/\seq{x}]\psi'}{\FALSE})}\).
%
By \rn{A-CoerceAdd}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_1}{\LETEQIN{y}{e_{21}}{\tuple{y,e_{22}}}}\).
By Lemma~\ref{lem:vweakeningaux}, we obtain some \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_2}{e_2}\) and
\item \([\seq{v}/\seq{x}]\LETEQIN{y}{e_{21}}{\tuple{y,e_{22}}} \redswith{\epsilon}{} \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2\).
\end{itemize}
We get
\begin{eqnarray*}
[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_1 
&=& [\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]\LETEQIN{y}{e_{11}}{\tuple{y,e_{12}}} \\
&\equiv& [\seq{v}/\seq{x}]\LETEQIN{y}{e_{21}}{\tuple{y,e_{22}}} \\
&\equiv& \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2.
\end{eqnarray*}

\item[] \rn{A-CoerceRem}
We have
\begin{itemize}
\item \(\sigma_1=b[\seq{P}]\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{v}{b[\seq{Q},\seq{P}]}{e_{11}}\), and
\item \(e_1=\LETEQIN{\tuple{\seq{x},\seq{y}}}{e_{11}}{\tuple{\seq{y}}}\).
\end{itemize}
By I.H., we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{b[\seq{Q},\seq{P}]}{e_{21}}\) and
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_{11} \equiv [\seq{v}/\seq{x}]e_{21}\).
\end{itemize}
By \rn{A-CoerceRem}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_1}{\LETEQIN{\tuple{\seq{x},\seq{y}}}{e_{21}}{\tuple{\seq{y}}}}\).
By Lemma~\ref{lem:vweakeningaux}, we obtain some \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_2}{e_2}\) and
\item \([\seq{v}/\seq{x}]\LETEQIN{\tuple{\seq{x},\seq{y}}}{e_{21}}{\tuple{\seq{y}}} \equiv \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2\).
\end{itemize}
We obtain
\begin{eqnarray*}
[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_1
&=&[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]\LETEQIN{\tuple{\seq{x},\seq{y}}}{e_{11}}{\tuple{\seq{y}}} \\
&\equiv&[\seq{v}/\seq{x}]\LETEQIN{\tuple{\seq{x},\seq{y}}}{e_{21}}{\tuple{\seq{y}}} \\
&\equiv&\Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2.
\end{eqnarray*}

\item[] \rn{A-CoerceFun}
We have
\begin{itemize}
\item \(\sigma_1=y:\sigma_{11} \to \sigma_{12}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{v}{(y:\sigma_{11}' \to \sigma_{12}')}{e_{11}}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1,y\COL\sigma_{11}}{y}{\sigma_{11}'}{e_{1y}}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1,y\COL\sigma_{11},y'\COL\sigma_{11}',r\COL\sigma_{12}'}{r}{\sigma_{12}}{e_{1r}}\), and
\item \(e_1=\lambda y.\LETEQIN{y'}{e_{1y}}\LETEQIN{r}{e_{11}\ y'}e_{1r}\).
\end{itemize}
By I.H., we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{(y:\sigma_{11}' \to \sigma_{12}')}{e_{21}}\),
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_{11} \equiv [\seq{v}/\seq{x}]e_{21}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2,y\COL\sigma_{11}}{y}{\sigma_{11}'}{e_{2y}}\),
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x},v_y/y]e_{1y} \equiv [\seq{v}/\seq{x},v_y/y]e_{2y}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2,y\COL\sigma_{11},y'\COL\sigma_{11}',r\COL\sigma_{12}'}{r}{\sigma_{12}}{e_{2r}}\), and
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x},\seq{v}'/(y,y',r)]e_{1r} \equiv [\seq{v}/\seq{x},\seq{v}'/(y,y',r)]e_{2r}\).
\end{itemize}
By \rn{A-CoerceFun}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_1}{\lambda y.\LETEQIN{y'}{e_{2y}}\LETEQIN{r}{e_{21}\ y'}e_{2r}}\).
By Lemma~\ref{lem:vweakeningaux}, we obtain some \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\sigma_2}{e_2}\) and
\item \([\seq{v}/\seq{x}]\lambda y.\LETEQIN{y'}{e_{2y}}\LETEQIN{r}{e_{21}\ y'}e_{2r} \redswith{\epsilon}{} \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2\).
\end{itemize}
We obtain 
\begin{eqnarray*}
&&[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_1 \\
&=&[\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]\lambda y.\LETEQIN{y'}{e_{1y}}\LETEQIN{r}{e_{11}\ y'}e_{1r} \\
&\equiv&[\seq{v}/\seq{x}]\lambda y.\LETEQIN{y'}{e_{2y}}\LETEQIN{r}{e_{21}\ y'}e_{2r} \\
&\equiv& \Pi_{\sigma_1}^{\sigma_2}[\seq{v}/\seq{x}]e_2.
\end{eqnarray*}
\end{itemize}
\end{proof}

\begin{lemma}
\label{lem:aweakening}
If \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{a}{\TUNIT}{e_1}\) and 
\(\seq{\sigma}_1 \sqsubseteq \seq{\sigma}_2\), then there exists \(e_2\) 
such that 
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{a}{\TUNIT}{e_2}\),
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\), 
then \([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f\ \seq{v}\), 
then \([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} f\ \seq{v}\)
\end{itemize}
\end{lemma}
\begin{proof}
Case analysis on the form of \(a\):
\begin{itemize}
\item \(a=x\) or \(a=c\)

%%
%By Lemma~\ref{lem:vweakening}, we obtain
%\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{\X{a}{j}}{\TUNIT}{e_2}\).
%%
%Note that
%\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} \FAIL\) and
%\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} f\ \seq{v}\) for any \(\seq{v}\).
%
By \rn{A-Base} and \rn{A-CoerceRem}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{a}{\TUNIT}{e_2}\), where
\(e_2=\LETEQIN{y}{\TRUE}{\tuple{}}\).
Note that
\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} \FAIL\) and
\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} f\ \seq{v}'\) for any \(\seq{v}\) and \(\seq{v}'\).

\item \(a=\FAIL\)

By \rn{A-Fail}, we get some \(\psi\) such that
\begin{itemize}
\item \(e_1=\ASSUME{\psi}\FAIL\) and
\item \(\models \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1} \psi\).
\end{itemize}
%
We have \(\models \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2} [\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{x}/\seq{x}]\psi\).
%
Thus, by \rn{A-Fail}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{a}{\TUNIT}{e_2}\), where
\(e_2=\ASSUME{[\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{x}/\seq{x}]\psi}{\FAIL}\).
%
Note that
\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} f\ \seq{v}'\) for any \(\seq{v}\) and  \(\seq{v}'\).
%
Suppose that
\([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\).
We obtain
\([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1=[\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\).

\item \(a=f_m\ \seq{v}\)

By \rn{A-App}, we obtain
\begin{itemize}
\item \((\Gamma,\seq{x}:\seq{\sigma}_1)(f_m)=
(y_1\COL\sigma_{m,1} \to \cdots \to y_k\COL\sigma_{m,k} \to \TUNIT)\),
\item for each \(i\in\set{1,\ldots,k}\), \(\T{\Gamma,\seq{x}:\seq{\sigma}_1,y_1:\sigma_{m,1},\dots,y_{i-1}:\sigma_{m,i-1}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_{m,i}}{e_i'}\), and
\item \(e_1=\LETEQIN{\seq{y}}{\seq{e}'}{f_m\ \seq{y}}\).
\end{itemize}
We get \((\Gamma,\seq{x}:\seq{\sigma}_2)(f_m)=
(y_1\COL\sigma_{m,1} \to \cdots \to y_k\COL\sigma_{m,k} \to \TUNIT)\).
By Lemma~\ref{lem:vweakening}, we obtain for each \(i\in\set{1,\ldots,k}\),
\begin{itemize}
\item \quad\(\T{\Gamma,\seq{x}:\seq{\sigma}_2,y_1:\sigma_{m,1},\dots,y_{i-1}:\sigma_{m,i-1}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_{m,i}}{e_i''}\)
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x},\seq{v}'/(y_1,\dots,y_{i-1})]e_i' \equiv [\seq{v}/\seq{x},\seq{v}'/(y_1,\dots,y_{i-1})]e_i''\).
\end{itemize}
By \rn{A-App}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{a}{\TUNIT}{e_2}\), where
\(e_2=\LETEQIN{\seq{y}}{\seq{e}''}{f_m\ \seq{y}}\).
%
Note that
\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} \FAIL\) for any \(\seq{v}\).
%
Suppose that \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f\ \seq{v}'\).
We obtain
\([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} f\ \seq{v}'\).

\item \(a=x\ \seq{v}\)

Similar to the case \(a=f_m\ \seq{v}\).

\end{itemize}
\end{proof}

\begin{pfof}{Lemma~\ref{lem:weakening}}
\begin{itemize}
\item if \(e=\ASSUME{v}{a}\), then by \rn{A-Assume}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{v}{\TBOOL[\lambda x.x=\TRUE]}{e_1'}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1,x\COL\TBOOL[\lambda x.v]}{a}{\TUNIT}{e_2'}\), and
\item \(e_1=\LETEQIN{x}{e_1'}\ASSUME{x}{e_2'}\).
\end{itemize}
By Lemma~\ref{lem:vweakening}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{v}{\TBOOL[\lambda x.x=\TRUE]}{e_1''}\) and
\item \([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x}]e_1 \equiv [\seq{v}/\seq{x}]e_1''\).
\end{itemize}
By Lemma~\ref{lem:aweakening}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2,x\COL\TBOOL[\lambda x.v]}{a}{\TUNIT}{e_2''}\),
\item if \([\seq{v}/\seq{x},v_x/x]e_2'' \redswith{\epsilon}{} \FAIL\), then 
\([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x},v_x/x]e_2 \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x},v_x/x]e_2'' \redswith{\epsilon}{} f\ \seq{v}\), then 
\([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x},v_x/x]e_2 \redswith{\epsilon}{} f\ \seq{v}\).
\end{itemize}
By \rn{A-Assume}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{e}{\TUNIT}{e_2}\), where
\(e_2=\LETEQIN{x}{e_1''}\ASSUME{x}{e_2''}\).
Suppose that \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\).
Then, we get \([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} \FAIL\).
Suppose that \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f\ \seq{v}\).
Then, we obtain \([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} f\ \seq{v}\).

\item if \(e=\LETEQIN{x}{\OP(\seq{v})}{a}\), then by \rn{A-LET}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1}{\OP(\seq{v})}{\sigma}{e_1'}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_1,x\COL\sigma}{a}{\TUNIT}{e_2'}\), and
\item \(e_1=\LETEQIN{x}{e_1'}e_2'\).
\end{itemize}
By \rn{A-Base}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{\OP(\seq{v})}{\sigma}{e_1'}\).
By Lemma~\ref{lem:aweakening}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2,x\COL\sigma}{a}{\TUNIT}{e_2''}\),
\item if \([\seq{v}/\seq{x},v_x/x]e_2'' \redswith{\epsilon}{} \FAIL\), then 
\([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x},v_x/x]e_2 \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x},v_x/x]e_2'' \redswith{\epsilon}{} f\ \seq{v}\), then 
\([\Pi_{\seq{\sigma}_1}^{\seq{\sigma}_2}\seq{v}/\seq{x},v_x/x]e_2 \redswith{\epsilon}{} f\ \seq{v}\).
\end{itemize}
By \rn{A-Let}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}_2}{e}{\TUNIT}{e_2}\), where
\(e_2=\LETEQIN{x}{e_1'}e_2''\).
Suppose that \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\).
Then, we get \([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} \FAIL\).
Suppose that \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f\ \seq{v}\).
Then, we obtain \([\Pi^{\seq{\sigma}_2}_{\seq{\sigma}_1}\seq{v}/\seq{x}]e_1 \redswith{\epsilon}{} f\ \seq{v}\).
\end{itemize}
\end{pfof}

\subsection{Proof of Lemma~\protect\ref{lem:merge}}
\label{sec:merge}
%lem:subst
%lem:dfun
%  lem:subst
%lem:dbase
%lem:vmerge
%  lem:dbase
%  lem:dfun
%lem:amerge
%  lem:vmerge
%lem:merge
%  lem:vmerge
%  lem:amerge

The following lemma states that if \(e_1\) and \(e_2\) are abstractions 
of \(e\) with the same abstraction types \(\seq{\sigma}\) (recall that 
our predicate abstraction is non-deterministic), then we can construct 
another abstraction \(e_3\) that is more precise than both \(e_1\) and 
\(e_2\).
%if \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{e}{\TUNIT}{e_1}\) and 
%\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{e}{\TUNIT}{e_2}\) are derivable, 
%we can derive \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{e}{\TUNIT}{e_3}\) 
%for some \(e_3\) such that \(e_1\) and \(e_2\) are over-approximations 
%of \(e_3\).
\begin{lemma}
\label{lem:merge}
%
If \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{e}{\TUNIT}{e_1}\) and 
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{e}{\TUNIT}{e_2}\), then there 
exists \(e_3\) such that 
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{e}{\TUNIT}{e_3}\),
\item for each \(i \in \set{1,2}\), 
if \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} \FAIL\), then 
\([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{} \FAIL\), and
\item for each \(i \in \set{1,2}\), 
if \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} f\ \seq{v}'\), then 
\([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{}\geq f\ \seq{v}'\).
\end{itemize}
\end{lemma}
Before we prove Lemma~\protect\ref{lem:merge} at the end of this section, 
we prepare Lemmas~\ref{lem:subst}--\ref{lem:amerge}.

\begin{lemma}
\label{lem:subst}
If \(\T{\Gamma,\seq{x}_1:\seq{\sigma}_1}{v}{\sigma'}{e_1}\) and
\(\T{\Gamma,\seq{x}_1:\seq{\sigma}_1,x:\sigma',\seq{x}_2:\seq{\sigma}_2}{e}{\sigma}{e_2}\), then
\(\T{\Gamma,\seq{x}_1:\seq{\sigma}_1,\seq{x}_2:[v/x]\seq{\sigma}_2}{[v/x]e}{[v/x]\sigma}{\equiv\LETEQIN{x}{e_1}{e_2}}\).
\end{lemma}
\begin{proof}
Similar to the proof of Lemma~\ref{lem:sub}.
\end{proof}

\begin{lemma}
\label{lem:dfun}
If \(\T{\Gamma,\seq{x}:\seq{\sigma}}{x\ \seq{v}}{(z:\sigma_{11} \to 
\sigma_{12})}{e}\), then we have
\begin{itemize}
\item \((\Gamma,\seq{x}:\seq{\sigma})(x)=(y_1\COL\sigma_1 \to \cdots \to y_k\COL\sigma_k \to z:\sigma_{21} \to \sigma_{22})\),
\item for each $i\in\set{1,\ldots,k}$, \(\T{\Gamma,\seq{x}:\seq{\sigma},y_1:\sigma_1,\dots,y_{i-1}:\sigma_{i-1}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_i}{e_i}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11}}{z}{[\seq{v}/\seq{y}]\sigma_{21}}{e_z}\)
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11},z':[\seq{v}/\seq{y}]\sigma_{21},r:[\seq{v}/\seq{y}]\sigma_{22}}{r}{\sigma_{12}}{e_r}\), and
\item \(e \equiv \lambda z.\LETEQIN{z'}{e_z}\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}\ z'}}e_r\).
\end{itemize}
\end{lemma}
\begin{proof}
We prove the lemma by induction on the derivation of 
\(\T{\Gamma,\seq{x}:\seq{\sigma}}{x\ \seq{v}}{(z:\sigma_{11} \to 
\sigma_{12})}{e}\). Case analysis on the last rule used:
\begin{itemize}
\item[] \rn{A-App}
We have 
\begin{itemize}
\item \(e=\LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}}\),
\item \([\seq{v}/\seq{y}]\sigma=z:\sigma_{11} \to \sigma_{12}\),
\item \((\Gamma,\seq{x}:\seq{\sigma})(x)=(y_1\COL\sigma_1 \to \cdots \to y_k\COL\sigma_k \to\sigma)\), and
\item for each \(i\in\set{1,\ldots,k}\), \(\T{\Gamma,\seq{x}:\seq{\sigma},y_1:\sigma_1,\dots,y_{i-1}:\sigma_{i-1}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_i}{e_i}\).
\end{itemize}
Let \(\sigma=z:\sigma_{21} \to \sigma_{22}\).
Then, by \rn{A-App}, we obtain
\begin{itemize}
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11}}{z}{[\seq{v}/\seq{y}]\sigma_{21}}{e_z}\) and
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11},z':[\seq{v}/\seq{y}]\sigma_{21},r:[\seq{v}/\seq{y}]\sigma_{22}}{r}{\sigma_{12}}{e_r}\),
\end{itemize}
Here, \(e_z=z\) and \(e_r=r\).
%
We get
\begin{eqnarray*}
e&=& \LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}} \\
&\equiv& \lambda z.\LETEQIN{z'}{e_z}\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}\ z'}}e_r
\end{eqnarray*}

\item[] \rn{A-CoerceFun}
We have
\begin{itemize}
\item \(e=\lambda z.\LETEQIN{z'}{e_1'}\LETEQIN{r}{e_3'\ z'}e_2'\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma}}{x\ \seq{v}}{(z:\sigma_{11}' \to 
\sigma_{12}')}{e_3'}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z\COL\sigma_{11}}{z}{\sigma_{11}'}{e_1'}\), and
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z\COL\sigma_{11},z'\COL\sigma_{11}',r\COL\sigma'_{12}}{r}{\sigma_{12}}{e_2'}\),
\end{itemize}
By I.H., we obtain
\begin{itemize}
\item \((\Gamma,\seq{x}:\seq{\sigma})(x)=(y_1\COL\sigma_1 \to \cdots \to y_k\COL\sigma_k \to z:\sigma_{21} \to \sigma_{22})\),
\item for each $i\in\set{1,\ldots,k}$, \(\T{\Gamma,\seq{x}:\seq{\sigma},y_1:\sigma_1,\dots,y_{i-1}:\sigma_{i-1}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\sigma_i}{e_i}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11}'}{z}{[\seq{v}/\seq{y}]\sigma_{21}}{e_z'}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11}',z':[\seq{v}/\seq{y}]\sigma_{21},r:[\seq{v}/\seq{y}]\sigma_{22}}{r}{\sigma_{12}'}{e_r'}\), and
\item \(e_3' \equiv \lambda z.\LETEQIN{z'}{e_z'}\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}\ z'}}e_r'\).
\end{itemize}
By Lemma~\ref{lem:subst}, we obtain
\begin{itemize}
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11}}{z}{[\seq{v}/\seq{y}]\sigma_{21}}{e_z}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z\COL\sigma_{11},r\COL\sigma'_{12}}{r}{\sigma_{12}}{\equiv \LETEQIN{z'}{e_1'}e_2'}\), and
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11},z':[\seq{v}/\seq{y}]\sigma_{21},r:[\seq{v}/\seq{y}]\sigma_{22}}{r}{\sigma_{12}'}{\equiv \LETEQIN{z}{e_1'}e_r'}\).
\end{itemize}
Here, \(e_z \equiv \LETEQIN{z}{e_1'}e_z'\).
Thus, by Lemma~\ref{lem:subst}, we get
\(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11},z':[\seq{v}/\seq{y}]\sigma_{21},r:[\seq{v}/\seq{y}]\sigma_{22}}{r}{\sigma_{12}}{e_r}\), where
\(e_r \equiv \LETEQIN{r}{\LETEQIN{z}{e_1'}e_r'}\LETEQIN{z'}{e_1'}e_2'\).
We get 
\begin{eqnarray*}
e&=&\lambda z.\LETEQIN{z'}{e_1'}\LETEQIN{r}{e_3'\ z'}e_2' \\
&\equiv& \lambda z.\LETEQIN{z'}{e_1'} \\
&&\LETEQIN{r}{[z'/z](\LETEQIN{z'}{e_z'} \\
&&\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}\ z'}}e_r')}e_2' \\
&\equiv& \lambda z.\LETEQIN{r}{(\LETEQIN{z}{e_1'}\LETEQIN{z'}{e_z'} \\
&&\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}\ z'}}e_r')} \\
&&\LETEQIN{z'}{e_1'}e_2' \\
&\equiv& \lambda z.\LETEQIN{z'}{\LETEQIN{z}{e_1'}e_z'} \\
&&\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}\ z'}} \\
&&\LETEQIN{r}{\LETEQIN{z}{e_1'}e_r'} \\
&&\LETEQIN{z'}{e_1'}e_2' \\
&\equiv& \lambda z.\LETEQIN{z'}{e_z}\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}}{x\ \seq{y}\ z'}}e_r
\end{eqnarray*}
\end{itemize}
\end{proof}

\begin{lemma}
\label{lem:dbase}
If \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[\seq{P}]}{e}\), then
there exists the following derivation:

\infer[\rn{A-CoerceRem}]
{\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[P_1,\dots,P_n]}{e^{(n)}}}
{\infer[\rn{A-CoerceAdd}]
{\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[\lambda \nu.\nu=v,P_1,\dots,P_{n-1}]}{e^{(n-1)}}}
{\infer[\rn{A-CoerceAdd}]
{\vdots}
{\infer[\rn{A-Base}]
{\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[\lambda \nu.\nu=v]}{e^{(0)}}}
{}}}}
Here, we have
\begin{itemize}
\item \(e^{(0)}=\TRUE\),
\item \(e^{(n)} \equiv e\),
\item for each \(i \in \set{1,\dots,n}\), 
\begin{eqnarray*}
e^{(i)}&=&\LETEQIN{y}{e^{(i-1)}} \\
&&\tuple{y,\PARB{(\ASSUME{\psi_i^{(i)}}{\TRUE})}{(\ASSUME{\psi_i'^{(i)}}{\FALSE})}},
\end{eqnarray*}
\item \(\models  P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma},y:b[\lambda \nu.\nu=v,P_1,\dots,P_{i-1}]}\psi_i^{(i)}\), and
\item \(\models \neg P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma},y:b[\lambda \nu.\nu=v,P_1,\dots,P_{i-1}]}\psi_i'^{(i)}\).
\end{itemize}
\end{lemma}
\begin{proof}
By induction on the derivation of \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[\seq{P}]}{e}\).
\end{proof}

\begin{lemma}
\label{lem:vmerge}
Suppose that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{\sigma}{e_1}\) and
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{\sigma}{e_2}\).
\end{itemize}
There exists \(e_3\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{\sigma}{e_3}\) and
\item \(e_3 \leq e_i\) for each \(i \in \set{1,2}\).
\end{itemize}
Here, we write \(e \leq e'\) if for any context \(C\),
\begin{itemize}
\item \(C[e] \redswith{s}{} v\) implies \(C[e'] \redswith{s}{}\geq v\) and
\item \(C[e] \redswith{s}{} \FAIL\) implies \(C[e'] \redswith{s}{} \FAIL\).
\end{itemize}
\end{lemma}
\begin{proof}
We prove the lemma by induction on the size of \(\alphaB(\sigma)\).
Case analysis on the form of \(\sigma\).
\begin{itemize}
\item[] case \(\sigma=b[\seq{P}]\):
By Lemma~\ref{lem:dbase}, for each \(i \in \set{1,2}\), we obtain the following derivation:

\infer[\rn{A-CoerceRem}]
{\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[P_1,\dots,P_n]}{e_i^{(n)}}}
{\infer[\rn{A-CoerceAdd}]
{\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[\lambda \nu.\nu=v,P_1,\dots,P_{n-1}]}{e_i^{(n-1)}}}
{\infer[\rn{A-CoerceAdd}]
{\vdots}
{\infer[\rn{A-Base}]
{\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[\lambda \nu.\nu=v]}{e_i^{(0)}}}
{}}}}
Here, we have
\begin{itemize}
\item \(e_i^{(0)}=\TRUE\),
\item \(e_i^{(n)} \equiv e_i\),
\item for each \(j \in \set{1,\dots,n}\), 
\begin{eqnarray*}
e_i^{(j)}&=&\LETEQIN{y}{e_i^{(j-1)}} \\
&&\tuple{y,\PARB{(\ASSUME{\psi_i^{(j)}}{\TRUE})}{(\ASSUME{\psi_i'^{(j)}}{\FALSE})}},
\end{eqnarray*}
\item \(\models  P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma},y:b[\lambda \nu.\nu=v,P_1,\dots,P_{j-1}]}\psi_i^{(j)}\), and
\item \(\models \neg P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma},y:b[\lambda \nu.\nu=v,P_1,\dots,P_{j-1}]}\psi_i'^{(j)}\).
\end{itemize}

We can obtain some \(e_3\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{b[P_1,\dots,P_n]}{e_3}\),
\item \(e_3=e_3^{(n)}\),
\item \(e_3^{(0)}=\TRUE\),
\item for each \(j \in \set{1,\dots,n}\), 
\begin{eqnarray*}
e_3^{(j)}&=&\LETEQIN{y}{e_3^{(j-1)}} \\
&&\tuple{y,\PARB{(\ASSUME{\psi_3^{(j)}}{\TRUE})}{(\ASSUME{\psi_3'^{(j)}}{\FALSE})}},
\end{eqnarray*}
\item \(\psi_3^{(j)}=\psi_1^{(j)} \land \psi_2^{(j)}\), and
\item \(\psi_3'^{(j)}=\psi_1'^{(j)} \land \psi_2'^{(j)}\).
\end{itemize}
We get \(e_3 \leq e_i\) for each \(i \in \set{1,2}\).

\item[] case \(\sigma=x:\sigma_1 \to \sigma_2\):
\begin{itemize}
\item[] case \(v=f\ \seq{v}\):
By Lemma~\ref{lem:dfun}, we obtain for each \(i \in \set{1,2}\),
\begin{itemize}
\item \((\NAT{\Gamma},\seq{x}:\seq{\sigma})(f)=(y_1\COL\sigma_1 \to \cdots \to y_k\COL\sigma_k \to x:\sigma_1' \to \sigma_2')\),
\item for each \(n\in\set{1,\ldots,k}\), \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},y_1:\sigma_1,\dots,y_{n-1}:\sigma_{n-1}}{v}{[v_1/y_1,\ldots,v_{n-1}/y_{n-1}]\sigma_n}{e_{i n}}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},x:\sigma_1}{x}{[\seq{v}/\seq{y}]\sigma_1'}{e_i'}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},x:\sigma_1,x':[\seq{v}/\seq{y}]\sigma_1',r:[\seq{v}/\seq{y}]\sigma_2'}{r}{\sigma_2}{e_i''}\), and
\item \begin{eqnarray*}
e_i &\equiv& \lambda x.\LETEQIN{x'}{e_i'} \\
&&\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}_i}{f\ \seq{y}\ x'}}e_i''.
\end{eqnarray*}
\end{itemize}
By I.H., we obtain
\begin{itemize}
\item for each \(n\in\set{1,\ldots,k}\), \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},y_1:\sigma_1,\dots,y_{n-1}:\sigma_{n-1}}{v}{[v_1/y_1,\ldots,v_{n-1}/y_{n-1}]\sigma_n}{e_{3n}}\),
\item for each \(n\in\set{1,\ldots,k}\) and \(i \in \set{1,2}\), \(e_{3n} \leq e_{i n}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},x:\sigma_1}{x}{[\seq{v}/\seq{y}]\sigma_1'}{e_3'}\),
\item \(e_3' \leq e_i'\) for each \(i \in \set{1,2}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},x:\sigma_1,x':[\seq{v}/\seq{y}]\sigma_1',r:[\seq{v}/\seq{y}]\sigma_2'}{r}{\sigma_2}{e_3''}\), and
\item \(e_3'' \leq e_i''\) for each \(i \in \set{1,2}\).
\end{itemize}
By \rn{A-CoerceFun}, we get \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{\sigma}{e_3}\).
We obtain \(e_3 \leq e_i\) for each \(i \in \set{1,2}\).

\item[] case \(v=y\ \seq{v}\): similar to the case \(v=f\ \seq{v}\).
\end{itemize}
\end{itemize}
\end{proof}

\begin{lemma}
\label{lem:amerge}
If \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{a}{\TUNIT}{e_1}\) and 
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{a}{\TUNIT}{e_2}\), then there 
exists \(e_3\) such that 
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{a}{\TUNIT}{e_3}\),
\item for each \(i \in \set{1,2}\), 
if \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} \FAIL\), then 
\([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{} \FAIL\), and
\item for each \(i \in \set{1,2}\), 
if \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} f\ \seq{v}'\), then 
\([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{}\geq f\ \seq{v}'\).
\end{itemize}
\end{lemma}
\begin{proof}
Case analysis on the form of \(a\):
\begin{itemize}
\item \(a=x\) or \(a=c\)

By \rn{A-Base} and \rn{A-CoerceRem}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{a}{\TUNIT}{e_3}\), where
\(e_3=\LETEQIN{y}{\TRUE}{\tuple{}}\).
Note that
\([\seq{v}/\seq{x}]e_3 \not\redswith{\epsilon}{} \FAIL\) and
\([\seq{v}/\seq{x}]e_3 \not\redswith{\epsilon}{} f\ \seq{v}'\) for any \(\seq{v}\) and \(\seq{v}'\).

\item \(a=\FAIL\)

By \rn{A-Fail}, we get some \(\psi\) such that for each \(i \in \set{1,2}\), 
\begin{itemize}
\item \(e_i=\ASSUME{\psi_i}\FAIL\) and
\item \(\models \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}} \psi_i\).
\end{itemize}
%
We have \(\models \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}} (\psi_1 \land \psi_2)\).
Thus, by \rn{A-Fail}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{a}{\TUNIT}{e_3}\), where
\(e_3=\ASSUME{\psi_1 \land \psi_2}{\FAIL}\).
%
Note that
\([\seq{v}/\seq{x}]e_3 \not\redswith{\epsilon}{} f\ \seq{v}'\) for any \(\seq{v}\) and  \(\seq{v}'\).
%
Suppose that
\([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} \FAIL\).
We obtain for each \(i \in \set{1,2}\),
\([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{} \FAIL\).

\item \(a=f_m\ \seq{v}\)

By \rn{A-App}, we obtain for each \(i \in \set{1,2}\), 
\begin{itemize}
\item \((\Gamma,\seq{x}:\seq{\sigma})(f_m)=
(y_1\COL\sigma_{m,1} \to \cdots \to y_k\COL\sigma_{m,k} \to \TUNIT)\),
\item for each \(n\in\set{1,\ldots,k}\), \(\T{\Gamma,\seq{x}:\seq{\sigma},y_1:\sigma_{m,1},\dots,y_{n-1}:\sigma_{m,n-1}}{v_n}{[v_1/y_1,\ldots,v_{n-1}/y_{n-1}]\sigma_{m,n}}{e_{i n}'}\), and
\item \(e_i=\LETEQIN{\seq{y}}{\seq{e}_i'}{f_m\ \seq{y}}\).
\end{itemize}
By Lemma~\ref{lem:vmerge}, we obtain for each \(n\in\set{1,\ldots,k}\),
\begin{itemize}
\item \quad\(\T{\Gamma,\seq{x}:\seq{\sigma},y_1:\sigma_{m,1},\dots,y_{n-1}:\sigma_{m,n-1}}{v_n}{[v_1/y_1,\ldots,v_{n-1}/y_{n-1}]\sigma_{m,n}}{e_{3n}'}\) and
\item \(e_{3n}' \leq e_{i n}'\) for each \(i \in \set{1,2}\).
\end{itemize}
By \rn{A-App}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{a}{\TUNIT}{e_3}\), where
\(e_3=\LETEQIN{\seq{y}}{\seq{e}_3'}{f_m\ \seq{y}}\).
%
Note that
\([\seq{v}/\seq{x}]e_3 \not\redswith{\epsilon}{} \FAIL\) for any \(\seq{v}\).
%
Suppose that \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} f\ \seq{v}'\).
We obtain
\([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{}\geq f\ \seq{v}'\) for each \(i \in \set{1,2}\).

\item \(a=x\ \seq{v}\)

Similar to the case \(a=f_m\ \seq{v}\).

\end{itemize}
\end{proof}

\begin{pfof}{Lemma~\ref{lem:merge}}
\begin{itemize}
\item if \(e=\ASSUME{v}{a}\), then by \rn{A-Assume}, we obtain for each \(i \in \set{1,2}\),
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{\TBOOL[\lambda x.x=\TRUE]}{e_{i1}}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},x\COL\TBOOL[\lambda x.v]}{a}{\TUNIT}{e_{i2}}\), and
\item \(e_i=\LETEQIN{x}{e_{i1}}\ASSUME{x}{e_{i2}}\).
\end{itemize}
By Lemma~\ref{lem:vmerge}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{v}{\TBOOL[\lambda x.x=\TRUE]}{e_{31}}\) and
\item \(e_{31} \leq e_{i1}\) for each \(i \in \set{1,2}\).
\end{itemize}
By Lemma~\ref{lem:amerge}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},x\COL\TBOOL[\lambda x.v]}{a}{\TUNIT}{e_{32}}\),
\item if \([\seq{v}/(\seq{x},x)]e_{32} \redswith{\epsilon}{} \FAIL\), then 
\([\seq{v}/(\seq{x},x)]e_{i2} \redswith{\epsilon}{} \FAIL\) for each \(i \in \set{1,2}\), and
\item if \([\seq{v}/(\seq{x},x)]e_{32} \redswith{\epsilon}{} f\ \seq{v}\), then 
\([\seq{v}/(\seq{x},x)]e_{i2} \redswith{\epsilon}{}\geq f\ \seq{v}\) for each \(i \in \set{1,2}\).
\end{itemize}
By \rn{A-Assume}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{e}{\TUNIT}{e_3}\), where
\(e_3=\LETEQIN{x}{e_{31}}\ASSUME{x}{e_{32}}\).
Suppose that \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} \FAIL\).
Then, we get \([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{} \FAIL\) for each \(i \in \set{1,2}\).
Suppose that \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} f\ \seq{v}\).
Then, we obtain \([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{}\geq f\ \seq{v}\) for each \(i \in \set{1,2}\).

\item if \(e=\LETEQIN{x}{\OP(\seq{v})}{a}\), then by \rn{A-LET}, for each \(i \in \set{1,2}\), we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{\OP(\seq{v})}{\sigma}{\TRUE}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},x\COL\sigma}{a}{\TUNIT}{e_i'}\), and
\item \(e_i=\LETEQIN{x}{\TRUE}e_i'\).
\end{itemize}
By Lemma~\ref{lem:amerge}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma},x\COL\sigma}{a}{\TUNIT}{e_3'}\),
\item if \([\seq{v}/(\seq{x},x)]e_3' \redswith{\epsilon}{} \FAIL\), then 
\([\seq{v}/(\seq{x},x)]e_i' \redswith{\epsilon}{} \FAIL\) for each \(i \in \set{1,2}\), and
\item if \([\seq{v}/(\seq{x},x)]e_3' \redswith{\epsilon}{} f\ \seq{v}\), then 
\([\seq{v}/(\seq{x},x)]e_i' \redswith{\epsilon}{}\geq f\ \seq{v}\) for each \(i \in \set{1,2}\).
\end{itemize}
By \rn{A-Let}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\seq{\sigma}}{e}{\TUNIT}{e_3}\), where
\(e_3=\LETEQIN{x}{\TRUE}e_3'\).
Suppose that \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} \FAIL\).
Then, we get \([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{} \FAIL\) for each \(i \in \set{1,2}\).
Suppose that \([\seq{v}/\seq{x}]e_3 \redswith{\epsilon}{} f\ \seq{v}\).
Then, we obtain \([\seq{v}/\seq{x}]e_i \redswith{\epsilon}{}\geq f\ \seq{v}\) for each \(i \in \set{1,2}\).
\end{itemize}
\end{pfof}

\subsection{Proof of Lemma~\protect\ref{lem:conv}}
\label{sec:conv}
%lem:vconvbase
%lem:vconvvar
%lem:vconv
%  lem:vconvbase
%  lem:dfun
%  lem:vweakening
%  lem:vmerge
%  lem:vconvvar
%lem:aconv
%  lem:vconv
%  lem:vweakening
%lem:conv
%  lem:aconv

The following lemma states that if \(e_1\) is an abstraction of 
\(\X{e}{j}\) with abstraction types \(\seq{\sigma}\), we can use 
\(\NAT{\seq{\sigma}}\) to construct an abstraction \(e_2\) of \(e\).
%if \(\T{\Gamma,\seq{x}:\seq{\sigma}}{\X{e}{j}}{\TUNIT}{e_1}\) is 
%derivable, we can derive 
%\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{e}{\TUNIT}{e_2}\) for some 
%\(e_2\) such that \(e_1\) is an over-approximation of \(e_2\). 
%%íPÇ»ÇÈover-approximationÇ≈ÇÕÇ»Ç¢Ç™ê‡ñæÇµÇ…Ç≠Ç¢
\begin{lemma}
\label{lem:conv}
%
If \(\T{\Gamma,\seq{x}:\seq{\sigma}}{\X{e}{j}}{\TUNIT}{e_1}\), then 
there exists \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{e}{\TUNIT}{e_2}\),
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f_i\ \seq{v}'\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{}\geq \Copy{f_i}{j}\ \Dup{(\Pi_{i,j}\seq{v}')}{j+1}\).
\end{itemize}
\end{lemma}
Before we prove Lemma~\protect\ref{lem:conv} at the end of this section, 
we prepare Lemmas~\ref{lem:vconvbase}--\ref{lem:aconv}.

\begin{lemma}
\label{lem:vconvbase}
If \(\T{\Gamma,\seq{x}:\seq{\sigma}}{v}{b[\seq{P}]}{e}\), then there 
exists \(e'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{b[\seq{P}]}{e'}\) and
\item \([\Dup{\seq{v}}{j}/\seq{x}]e \equiv [\seq{v}/\seq{x}]e'\).
\end{itemize}
\end{lemma}
\begin{proof}
We prove the lemma by induction on the derivation of \(\T{\Gamma,\seq{x}:\seq{\sigma}}{v}{b[\seq{P}]}{e}\).
Case analysis on the last rule used:
\begin{itemize}
\item[] \rn{A-Base}
We have
\begin{itemize}
%\item \(v=x\) or \(v=c\),
\item \(b[\seq{P}]=b[\lambda \nu.\nu=v]\) and
\item \(e=\TRUE\).
\end{itemize}
We get \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{b[\seq{P}]}{e'}\), where
\(e'=\TRUE=e\).
We obtain
\([\Dup{\seq{v}}{j}/\seq{x}]e=[\seq{v}/\seq{x}]e'\).

\item[] \rn{A-App}
We have
\begin{itemize}
\item \(v=x\),
\item \((\Gamma,\seq{x}:\seq{\sigma})(x)=b[\seq{P}]\), and
\item \(e=x\).
\end{itemize}
We have \((\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}})(x)=b[\seq{P}]\).
By \rn{A-App}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{b[\seq{P}]}{e'}\), where
\(e'=x=e\).
We get
\([\Dup{\seq{v}}{j}/\seq{x}]e=[\Dup{\seq{v}}{j}/\seq{x}]e'=[\seq{v}/\seq{x}]e'\).

\item[] \rn{A-CoerceAdd}
We have
\begin{itemize}
\item \(b[\seq{P}]=b[\seq{Q},P]\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma}}{v}{b[\seq{Q}]}{e_1}\),
\item \(\models  P(y) \IMPLY \THE{\Gamma,\seq{x}:\seq{\sigma},y:b[\seq{Q}]}\psi\),
\item \(\models \neg P(y) \IMPLY \THE{\Gamma,\seq{x}:\seq{\sigma},y\COL b[\seq{Q}]}\psi'\),
\item \(e_2=\PARB{(\ASSUME{\psi}{\TRUE})}{(\ASSUME{\psi'}{\FALSE})}\), and
\item \(e=\LETEQIN{y}{e_1}{\tuple{y,e_2}}\).
\end{itemize}
By I.H., we obtain some \(e_1'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{b[\seq{Q}]}{e_1'}\),
\item \([\Dup{\seq{v}}{j}/\seq{x}]e_1 \equiv [\seq{v}/\seq{x}]e_1'\).
\end{itemize}
We have 
\(\models  P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y:b[\seq{Q}]}\psi\) and
\(\models \neg P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y:b[\seq{Q}]}\psi'\),
By \rn{A-CoerceAdd}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{b[\seq{P}]}{e'}\), where
\(e'=\LETEQIN{y}{e_1'}{\tuple{y,e_2}}\).
We get
\([\Dup{\seq{v}}{j}/\seq{x}]e \equiv [\seq{v}/\seq{x}]e'\).

\item[] \rn{A-CoerceRem}
We have
\begin{itemize}
\item \(\T{\Gamma,\seq{x}:\seq{\sigma}}{v}{b[\seq{Q},\seq{P}]}{e_1}\) and
\item \(e=\LETEQIN{\tuple{\seq{x},\seq{y}}}{e_1}{\tuple{\seq{y}}}\).
\end{itemize}
By I.H., we obtain some \(e_1'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{b[\seq{Q},\seq{P}]}{e_1'}\),
\item \([\Dup{\seq{v}}{j}/\seq{x}]e_1 \equiv [\seq{v}/\seq{x}]e_1'\).
\end{itemize}
By \rn{A-CoerceRem}, we get
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{b[\seq{P}]}{e'}\), where
\(e'=\LETEQIN{\tuple{\seq{x},\seq{y}}}{e_1'}{\tuple{\seq{y}}}\).
We get
\([\Dup{\seq{v}}{j}/\seq{x}]e \equiv [\seq{v}/\seq{x}]e'\).

\end{itemize}
\end{proof}

\begin{lemma}
\label{lem:vconvvar}
If \(\T{\Gamma,\seq{x}:\seq{\sigma}}{x}{\sigma}{e}\), then
there exists \(e'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{\sigma}}{e'}\) and
\item \([\Dup{\seq{v}}{j}/\seq{x}]e \equiv \Dup{([\seq{v}/\seq{x}]e')}{j}\).
\end{itemize}
\end{lemma}
\begin{proof}
We prove the lemma by induction on the derivation of \(\T{\Gamma,\seq{x}:\seq{\sigma}}{x}{\sigma}{e}\).
Case analysis on the last rule used:
\begin{itemize}
\item[] \rn{A-Base}
We have
\begin{itemize}
\item \(\sigma=b[\lambda \nu.\nu=v]\) and
\item \(e=\TRUE\).
\end{itemize}
We get \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{\sigma}}{e'}\), where
\(e'=\TRUE=e\).
We obtain \([\Dup{\seq{v}}{j}/\seq{x}]e=[\seq{v}/\seq{x}]e'=\Dup{([\seq{v}/\seq{x}]e')}{j}\).

\item[] \rn{A-App}
We have
\begin{itemize}
\item \(\sigma=(\Gamma,\seq{x}:\seq{\sigma})(x)\) and
\item \(e=x\).
\end{itemize}
We get \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{\sigma}}{e'}\), where
\(e'=x=e\).
We obtain \([\Dup{\seq{v}}{j}/\seq{x}]e=[\Dup{\seq{v}}{j}/\seq{x}]e'=\Dup{([\seq{v}/\seq{x}]e')}{j}\).

\item[] \rn{A-CoerceAdd}
We have
\begin{itemize}
\item \(\sigma=b[\seq{Q},P]\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma}}{x}{b[\seq{Q}]}{e_1}\),
\item \(\models  P(y) \IMPLY \THE{\Gamma,\seq{x}:\seq{\sigma},y:b[\seq{Q}]}\psi\),
\item \(\models \neg P(y) \IMPLY \THE{\Gamma,\seq{x}:\seq{\sigma},y\COL b[\seq{Q}]}\psi'\),
\item \(e_2=\PARB{(\ASSUME{\psi}{\TRUE})}{(\ASSUME{\psi'}{\FALSE})}\), and
\item \(e=\LETEQIN{y}{e_1}{\tuple{y,e_2}}\).
\end{itemize}
By I.H., we obtain some \(e_1'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{b[\seq{Q}]}}{e_1'}\) and
\item \([\Dup{\seq{v}}{j}/\seq{x}]e_1 \equiv \Dup{([\seq{v}/\seq{x}]e_1')}{j}\).
\end{itemize}
We obtain
\(\models  P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y:\NAT{b[\seq{Q}]}}\psi\) and
\(\models \neg P(y) \IMPLY \THE{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y:\NAT{b[\seq{Q}]}}\psi'\).
By \rn{A-CoerceAdd}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{\sigma}}{e'}\), where
\(e'=\LETEQIN{y}{e_1'}{\tuple{y,e_2}}\).
We obtain \([\Dup{\seq{v}}{j}/\seq{x}]e \equiv \Dup{([\seq{v}/\seq{x}]e')}{j}\).

\item[] \rn{A-CoerceRem}
We have
\begin{itemize}
\item \(\sigma=b[\seq{P}]\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma}}{x}{b[\seq{Q},\seq{P}]}{e_1}\), and
\item \(e=\LETEQIN{\tuple{\seq{z},\seq{y}}}{e_1}{\tuple{\seq{y}}}\).
\end{itemize}
By I.H., we obtain some \(e_1'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{b[\seq{Q},\seq{P}]}}{e_1'}\) and
\item \([\Dup{\seq{v}}{j}/\seq{x}]e_1 \equiv \Dup{([\seq{v}/\seq{x}]e_1')}{j}\).
\end{itemize}
By \rn{A-CoerceRem}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{\sigma}}{e'}\), where
\(e'=\LETEQIN{\tuple{\seq{z},\seq{y}}}{e_1'}{\tuple{\seq{y}}}\).
We obtain \([\Dup{\seq{v}}{j}/\seq{x}]e \equiv \Dup{([\seq{v}/\seq{x}]e')}{j}\).

\item[] \rn{A-CoerceFun}
We have
\begin{itemize}
\item \(\sigma=y:\sigma_1 \to \sigma_2\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma}}{x}{(y:\sigma_1' \to \sigma_2')}{e_1}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},y\COL\sigma_1}{y}{\sigma_1'}{e_y}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},y\COL\sigma_1,y'\COL\sigma_1',r\COL\sigma'_2}{r}{\sigma_2}{e_r}\), and
\item \(e=\lambda y.\LETEQIN{y'}{e_y}\LETEQIN{r}{e_1\ y'}e_r\).
\end{itemize}
By I.H., we obtain some \(e_1'\), \(e_y'\), and \(e_r'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{(y:\sigma_1' \to \sigma_2')}}{e_1'}\),
\item \([\Dup{\seq{v}}{j}/\seq{x}]e_1 \equiv \Dup{([\seq{v}/\seq{x}]e_1')}{j}\).
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y\COL\NAT{\sigma_1}}{y}{\NAT{\sigma_1'}}{e_y'}\),
\item \([\Dup{\seq{v}}{j}/\seq{x},y]e_y \equiv \Dup{([\seq{v}/\seq{x},y]e_y')}{j}\).
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y\COL\NAT{\sigma_1},y'\COL\NAT{\sigma_1'},r\COL\NAT{\sigma'_2}}{r}{\NAT{\sigma_2}}{e_r'}\), and
\item \([\Dup{\seq{v}}{j}/(\seq{x},y,y',r)]e_r \equiv \Dup{([\seq{v}/(\seq{x},y,y',r)]e_r')}{j}\).
\end{itemize}
By \rn{A-CoerceFun}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{x}{\NAT{\sigma}}{e'}\), where
\(e'=\lambda y.\LETEQIN{y'}{e_y'}\LETEQIN{r}{e_1'\ y'}e_r'\).
We obtain \([\Dup{\seq{v}}{j}/\seq{x}]e \equiv \Dup{([\seq{v}/\seq{x}]e')}{j}\).
%\todo{add explanation}
\end{itemize}
\end{proof}

\begin{lemma}
\label{lem:vconv}
If \(\T{\Gamma,\seq{x}:\seq{\sigma}}{\Dup{v}{j+1}}{\sigma}{e}\), then there 
exists \(e'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{\NAT{\sigma}}{e'}\) and
\item if \([\seq{v}/\seq{x}]e' \redswith{\epsilon}{} v'\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e \redswith{\epsilon}{}\geq \Dup{v'}{j+1}\).
\end{itemize}
\end{lemma}
\begin{proof}
We prove the lemma by induction on the structure of \(v\).
Case analysis on \(v\).
\begin{itemize}
\item[] case \(v\) is a base value:
Lemma~\ref{lem:vconvbase} applies.

\item[] case \(v=f\ \seq{v}\):
\begin{itemize}
\item \(\Dup{v}{j+1}=\tuple{\underbrace{\lambda\seq{y}.\tuple{},\ldots,\lambda\seq{y}.\tuple{}}_j,\Copy{f}{j+1}(\Dup{\seq{v}}{j+1}),\ldots,\Copy{f}{\ell}(\Dup{\seq{v}}{j+1})}\),
\item \(\sigma=\sigma_1 \times \dots \times \sigma_{\ell}\),
\item \(e=(e_1,\dots,e_{\ell})\),
\item for each \(i \in \set{1,\dots,j}\), \(\T{\Gamma,\seq{x}:\seq{\sigma}}{\lambda\seq{y}.\tuple{}}{\sigma_i}{e_i}\), and
\item for each \(i \in \set{j+1,\dots,\ell}\), \(\T{\Gamma,\seq{x}:\seq{\sigma}}{\Copy{f}{i}(\Dup{\seq{v}}{j+1})}{\sigma_i}{e_i}\).
\end{itemize}
%\todo{add explanation}
For each \(i \in \set{1,\dots,j}\), we obtain 
\([\Dup{\seq{v}}{j}/\seq{x}]e_i \equiv \lambda\seq{y}.\tuple{}\).
For each \(i \in \set{j+1,\dots,\ell}\), by Lemma~\ref{lem:dfun}, we get
\begin{itemize}
\item \(\sigma_i=z:\sigma_{11}^{(i)} \to \sigma_{12}^{(i)}\),
\item \((\Gamma,\seq{x}:\seq{\sigma})(f^{(i)})=(y_1\COL\sigma_1^{(i)} \to \cdots \to y_k\COL\sigma_k^{(i)} \to z:\sigma_{21}^{(i)} \to \sigma_{22}^{(i)})\),
\item for each $m\in\set{1,\ldots,k}$, \(\T{\Gamma,\seq{x}:\seq{\sigma},y_1:\sigma_1^{(i)},\dots,y_{m-1}:\sigma_{m-1}^{(i)}}{\Dup{v_m}{j+1}}{[\Dup{v_1}{j+1}/y_1,\ldots,\Dup{v_{m-1}}{j+1}/y_{m-1}]\sigma_m^{(i)}}{e_m^{(i)}}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11}^{(i)}}{z}{[\seq{v}/\seq{y}]\sigma_{21}^{(i)}}{e'^{(i)}}\)
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},z:\sigma_{11}^{(i)},z':[\seq{v}/\seq{y}]\sigma_{21}^{(i)},r:[\seq{v}/\seq{y}]\sigma_{22}^{(i)}}{r}{\sigma_{12}^{(i)}}{e''^{(i)}}\), and
\item \begin{eqnarray*}
e_i &\equiv& \lambda z.\LETEQIN{z'}{e'^{(i)}} \\
&&\LETEQIN{r}{\LETEQIN{\seq{y}}{\seq{e}^{(i)}}{f^{(i)}\ \seq{y}\ z'}}e''^{(i)}.
\end{eqnarray*}
\end{itemize}
By I.H., for each \(i \in \set{j+1,\dots,\ell}\) and \(m\in\set{1,\dots,k}\), 
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y_1:\NAT{\sigma_1^{(i)}},\dots,y_{m-1}:\NAT{\sigma_{m-1}^{(i)}}}{v_m}{\NAT{([v_1/y_1,\ldots,v_{m-1}/y_{m-1}]\sigma_m^{(i)})}}{e_m'^{(i)}}\) and
\item if \([\seq{v}/\seq{x}]e_m'^{(i)} \redswith{\epsilon}{} v'\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_m^{(i)} \redswith{\epsilon}{}\geq \Dup{v'}{j+1}\).
\end{itemize}
By Lemmas~\ref{lem:vweakening} and \ref{lem:vmerge}, for each \(m\in\set{1,\ldots,k}\), 
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y_1:\bigsqcup_{i=1}^{\ell}\NAT{\sigma_1^{(i)}},\dots,y_{m-1}:\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{m-1}^{(i)}}}{v_m}{[v_1/y_1,\ldots,v_{m-1}/y_{m-1}](\bigsqcup_{i=1}^{\ell}\NAT{\sigma_m^{(i)}})}{e_m'}\) and
\item for each \(i \in \set{j+1,\dots,\ell}\), if \([\seq{v}/(\seq{x},y_1,\dots,y_{m-1})]e_m' \redswith{\epsilon}{} v'\), then
\begin{eqnarray*}
&&[\Pi_{\NAT{\seq{\sigma}},\NAT{\sigma_1^{(i)}},\dots,\NAT{\sigma_{m-1}^{(i)}}}^
       {\NAT{\seq{\sigma}},\bigsqcup_{i=1}^{\ell}\NAT{\sigma_1^{(i)}},\dots,\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{m-1}^{(i)}}}
\seq{v}/(\seq{x},y_1,\dots,y_{m-1})]e_m'^{(i)} \\
&&\redswith{\epsilon}{}\geq \Pi_{\NAT{\sigma_m^{(i)}}}^{\bigsqcup_{i=1}^{\ell}\NAT{\sigma_m^{(i)}}}v'.
\end{eqnarray*}
\end{itemize}
By \rn{A-App}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{f\ \seq{v}}{[v_1/y_1,\ldots,v_k/y_k](z:(\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{21}^{(i)}}) \to (\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{22}^{(i)}}))}{\LETEQIN{\seq{y}}{\seq{e}''}f\ \seq{y}}\).
%
By Lemmas~\ref{lem:vconvvar}, \ref{lem:vweakening}, and \ref{lem:vmerge}, we obtain
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},z:\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{11}^{(i)}}}{z}{[\seq{v}/\seq{y}](\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{21}^{(i)}})}{e''}\),
\item for each \(i \in \set{j+1,\dots,\ell}\), if \([\seq{v}/(\seq{x},z)]e'' \redswith{\epsilon}{} v'\), then
\([\Dup{(\Pi_{\NAT{\seq{\sigma}},\NAT{\sigma_{11}^{(i)}}}^
            {\NAT{\seq{\sigma}},\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{11}^{(i)}}} \seq{v})}
       {j}/(\seq{x},z)]e'^{(i)} \redswith{\epsilon}{}\geq
\Dup{(\Pi_{[\seq{v}/\seq{y}]\NAT{\sigma_{21}^{(i)}}}^{[\seq{v}/\seq{y}](\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{21}^{(i)}})}v')}{j}\),
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},z:\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{11}^{(i)}},z':[\seq{v}/\seq{y}](\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{21}^{(i)}}),r:[\seq{v}/\seq{y}](\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{22}^{(i)}})}{r}{(\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{12}^{(i)}})}{e'''}\), and
\item for each \(i \in \set{j+1,\dots,\ell}\), if \([\seq{v}/(\seq{x},z,z',r)]e''' \redswith{\epsilon}{} v'\), then
\begin{eqnarray*}
&&[\Dup{
(\Pi_{\NAT{\seq{\sigma}},\NAT{\sigma_{11}^{(i)}},[\seq{v}/\seq{y}]\NAT{\sigma_{21}^{(i)}},[\seq{v}/\seq{y}]\NAT{\sigma_{22}^{(i)}}}^
     {\NAT{\seq{\sigma}},\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{11}^{(i)}},[\seq{v}/\seq{y}](\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{21}^{(i)}}),[\seq{v}/\seq{y}](\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{22}^{(i)}})}
\seq{v})}{j}/ \\
&&(\seq{x},z,z',r)]e''^{(i)} \redswith{\epsilon}{}\geq \Dup{(\Pi_{\NAT{\sigma_{12}^{(i)}}}^{\bigsqcup_{i=1}^{\ell}\NAT{\sigma_{12}^{(i)}}}v')}{j}.
\end{eqnarray*}
\end{itemize}
By \rn{A-CoerceFun}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{f\ \seq{v}}{\NAT{\sigma}}{e'}\), where
\(e'=\lambda z.\LETEQIN{z'}{e''}\LETEQIN{r}{(\LETEQIN{\seq{y}}{\seq{e}''}f\ \seq{y})\ z'}e'''\)
%%%by induction on the derivation of \(\T{\Gamma,\seq{x}:\seq{\sigma}}{\Copy{f}{i}(\Dup{\seq{v}}{j+1})}{\sigma_i}{e_i}\),
%%%we can prove that there exists some \(e_i'\) such that
%%%\begin{itemize}
%%%\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{f\ \seq{v}}{\NAT{\sigma_i}}{e_i'}\) and
%%%\item if \([\seq{v}/\seq{x}]e_i' \redswith{\epsilon}{} f\ \seq{v'}\), then 
%%%\([\Dup{\seq{v}}{j}/\seq{x}]e_i \redswith{\epsilon}{} \Copy{f}{i}\ \Dup{\seq{v'}}{j+1}\).
%%%\end{itemize}
%%%We get \(\NAT{\sigma}=\NAT{\sigma_1} \itlub \cdots \itlub \NAT{\sigma_{\ell}}\).
%%%%
%%%By Lemmas~\ref{lem:vmerge} and \ref{lem:vweakening}, we get some \(e'\) such that
%%%\begin{itemize}
%%%\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{\NAT{\sigma}}{e'}\) and
%%%\item for each \(i \in \set{1,\dots,\ell}\), if \([\seq{v}/\seq{x}]e' 
%%%\redswith{\epsilon}{} v'\), then \([\seq{v}/\seq{x}]e_i' 
%%%\redswith{\epsilon}{} v'\).
%%%\end{itemize}
Suppose that \([\seq{v}/\seq{x}]e' \redswith{\epsilon}{} v'\).
Then, we have 
\begin{eqnarray*}
[\Dup{\seq{v}}{j}/\seq{x}]e=[\Dup{\seq{v}}{j}/\seq{x}](e_1,\dots,e_{\ell}) \redswith{\epsilon}{}\geq \Dup{v'}{j+1}
%(\underbrace{\lambda\seq{y}.\tuple{},\ldots,\lambda\seq{y}.\tuple{}}_j,\Copy{f}{j+1}\ \Dup{\seq{v'}}{j+1},\dots,\Copy{f}{\ell}\ \Dup{\seq{v'}}{j+1}) \\
%&=&
\end{eqnarray*}
%\todo{add explanation}

\item[] case \(v=x\ \seq{v}\): similar to the case \(v=f\ \seq{v}\).
\end{itemize}
\end{proof}

\begin{lemma}
\label{lem:aconv}
%
If \(\T{\Gamma,\seq{x}:\seq{\sigma}}{\X{a}{j}}{\TUNIT}{e_1}\), then 
there exists \(e_2\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{a}{\TUNIT}{e_2}\),
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f_i\ \seq{v}'\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{}\geq \Copy{f_i}{j}\ \Dup{(\Pi_{i,j}\seq{v}')}{j+1}\).
\end{itemize}
Here, \(\Pi_{i,j} \seq{v}\) stands for \(\Pi^{\NAT{\seq{\sigma}_{i,1}} \itlub \cdots 
\itlub \NAT{\seq{\sigma}_{i,\ell}}}_{\NAT{\seq{\sigma}_{i,j}}}(\seq{v})\).
%\(\X{e_2}{j} \subseteq e_1\) for some .
\end{lemma}
\begin{proof}
Case analysis on the form of \(a\):
\begin{itemize}
\item \(a=x\) or \(a=c\)

By \rn{A-Base} and \rn{A-CoerceRem}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{a}{\TUNIT}{e_2}\), where
\(e_2=\LETEQIN{y}{\TRUE}{\tuple{}}\).
Note that
\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} \FAIL\) and
\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} f_i\ \seq{v}'\) for any \(\seq{v}\) and \(\seq{v}'\).

\item \(a=\FAIL\)

By \rn{A-Fail} and \(\X{a}{j}=a\), we get some \(\psi\) such that
\begin{itemize}
\item \(e_1=\ASSUME{\psi}\FAIL\) and
\item \(\models \THE{\NAT{\Gamma},\seq{x}:\seq{\sigma}} \psi\).
\end{itemize}
%
We have \(\models \THE{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}} \psi\).
%
Thus, by \rn{A-Fail}, we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{a}{\TUNIT}{e_2}\), where
\(e_2=\ASSUME{\psi}{\FAIL}\).
%
Note that
\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} f_i\ \seq{v}'\) for any \(\seq{v}\) and \(\seq{v}'\).
%
Suppose that
\([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\).
We obtain
\([\Dup{\seq{v}}{j}/\seq{x}]e_1=[\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\).

\item \(a=f_m\ \seq{v}\)

We have \(\X{a}{j}=\Copy{f_m}{j}\ \Dup{(\seq{v})}{j+1}\).
%
By \rn{A-App}, we obtain
\begin{itemize}
\item \((\Gamma,\seq{x}:\seq{\sigma})(\Copy{f_m}{j})=
(y_1\COL\sigma_{m,j,1} \to \cdots \to y_k\COL\sigma_{m,j,k} \to \TUNIT)\),
\item for each $i\in\set{1,\ldots,k}$, \(\T{\Gamma,\seq{x}:\seq{\sigma},y_1:\sigma_{m,j,1},\dots,y_{i-1}:\sigma_{m,j,i-1}}{\Dup{v_i}{j+1}}{[\Dup{v_1}{j+1}/y_1,\ldots,\Dup{v_{i-1}}{j+1}/y_{i-1}]\sigma_{m,j,i}}{e_i'}\), and
\item \(e_1=\LETEQIN{\seq{y}}{\seq{e}'}{\Copy{f_m}{j}\ \seq{y}}\).
\end{itemize}
By Lemma~\ref{lem:vconv}, for each \(i\in\set{1,\ldots,k}\), we get some \(e_i'''\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y_1:\NAT{\sigma_{m,j,1}},\dots,y_{i-1}:\NAT{\sigma_{m,j,i-1}}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\NAT{\sigma_{m,j,i}}}{e_i'''}\) and
\item if \([\seq{v}/(\seq{x},y_1,\dots,y_{i-1})]e_i''' \redswith{\epsilon}{} v'\), then
\begin{eqnarray*}
[\Dup{\seq{v}}{j}/(\seq{x},y_1,\dots,y_{i-1})]e_i' \redswith{\epsilon}{}\geq \Dup{v'}{j+1}.
\end{eqnarray*}
\end{itemize}
%
By Lemma~\ref{lem:vweakening}, for each \(i\in\set{1,\ldots,k}\), we get some \(e_i''\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},y_1:\itlub_{j=1}^{\ell}\NAT{\sigma_{m,j,1}},\dots,y_{i-1}:\itlub_{j=1}^{\ell}\NAT{\sigma_{m,j,i-1}}}{v_i}{[v_1/y_1,\ldots,v_{i-1}/y_{i-1}]\itlub_{j=1}^{\ell}\NAT{\sigma_{m,j,i}}}{e_i''}\) and
\item \begin{eqnarray*}
&&[\Pi_{\NAT{\seq{\sigma}},\NAT{\sigma_{m,j,1}},\dots,\NAT{\sigma_{m,j,i-1}}}^
{\NAT{\seq{\sigma}},\itlub_{j=1}^{\ell}\NAT{\sigma_{m,j,1}},\dots,
 \itlub_{j=1}^{\ell}\NAT{\sigma_{m,j,i-1}}} \seq{v}/(\seq{x},y_1,\dots,y_{i-1})]e_i''' \\
&&\equiv \Pi_{\NAT{\sigma_{m,j,i}}}^{\itlub_{j=1}^{\ell}\NAT{\sigma_{m,j,i}}}[\seq{v}/(\seq{x},y_1,\dots,y_{i-1})]e_i''.
\end{eqnarray*}
\end{itemize}
We have
\((\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}})(f_m)=
(y_1\COL(\itlub_{j=1}^{\ell}\NAT{\sigma_{m,j,1}}) \to \cdots \to
 y_k\COL(\itlub_{j=1}^{\ell}\NAT{\sigma_{m,j,k}}) \to \TUNIT)\),
%
By \rn{A-App}, we get
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{a}{\TUNIT}{e_2}\), where
\(e_2=\LETEQIN{\seq{y}}{\seq{e}''}{f_m\ \seq{y}}\)
%
We have
\([\seq{v}/\seq{x}]e_2 \not\redswith{\epsilon}{} \FAIL\) for any \(\seq{v}\).
%
Suppose that
\([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f_i\ \seq{v}'\).
Then, we obtain
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{}\geq \Copy{f_i}{j}\ \Dup{(\Pi_{i,j}\seq{v}')}{j+1}\).

\item \(a=x\ \seq{v}\)

Similar to the case \(a=f_m\ \seq{v}\).

\end{itemize}
\end{proof}

\begin{pfof}{Lemma~\ref{lem:conv}}
\begin{itemize}
\item if \(e=\ASSUME{v}{a}\), then we have \(\X{e}{j}=\ASSUME{v}{\X{a}{j}}\).
By \rn{A-Assume}, we obtain
\begin{itemize}
\item \(\T{\Gamma,\seq{x}:\seq{\sigma}}{v}{\TBOOL[\lambda x.x=\TRUE]}{e_1'}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},x\COL\TBOOL[\lambda x.v]}{\X{a}{j}}{\TUNIT}{e_2'}\), and
\item \(e_1=\LETEQIN{x}{e_1'}\ASSUME{x}{e_2'}\).
\end{itemize}
%\todo{add explanation}
We have \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{v}{\TBOOL[\lambda x.x=\TRUE]}{e_1'}\).
By Lemma~\ref{lem:aconv} and \(\NAT{\TBOOL[\lambda x.x=\TRUE]}=\TBOOL[\lambda x.x=\TRUE]\), we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},x\COL\TBOOL[\lambda x.v]}{a}{\TUNIT}{e_2''}\) for some \(e_2''\) such that
\begin{itemize}
\item if \([\seq{v}/(\seq{x},x)]e_2'' \redswith{\epsilon}{} \FAIL\), then 
\([\Dup{\seq{v}}{j}/(\seq{x},x)]e_2' \redswith{\epsilon}{} \FAIL\) and
\item if \([\seq{v}/(\seq{x},x)]e_2'' \redswith{\epsilon}{} f_i\ \seq{v}'\), then 
\([\Dup{\seq{v}}{j}/(\seq{x},x)]e_2' \redswith{\epsilon}{}\geq \Copy{f_i}{j}\ \Dup{(\Pi_{i,j}\seq{v}')}{j+1}\).
\end{itemize}
By \rn{A-Assume}, we get
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{e}{\TUNIT}{e_2}\), where
\(e_2=\LETEQIN{x}{e_1'}\ASSUME{x}{e_2''}\).
Thus, we obtain
\begin{itemize}
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f_i\ \seq{v}'\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{}\geq \Copy{f_i}{j}\ \Dup{(\Pi_{i,j}\seq{v}')}{j+1}\).
\end{itemize}

\item if \(e=\LETEQIN{x}{\OP(\seq{v})}{a}\), then
we have \(\X{e}{j}=\LETEQIN{x}{\OP(\seq{v})}\X{a}{j}\).
By \rn{A-LET}, we obtain
\begin{itemize}
\item \(\T{\Gamma,\seq{x}:\seq{\sigma}}{\OP(\seq{v})}{\sigma}{e_1'}\),
\item \(\T{\Gamma,\seq{x}:\seq{\sigma},x\COL\sigma}{\X{a}{j}}{\TUNIT}{e_2'}\), and
\item \(e_1=\LETEQIN{x}{e_1'}e_2'\).
\end{itemize}
By \rn{A-Base}, we have \(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{\OP(\seq{v})}{\sigma}{e_1'}\).
By Lemma~\ref{lem:aconv} and \(\NAT{\sigma}=\sigma\), we obtain
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}},x\COL\sigma}{a}{\TUNIT}{e_2''}\) for some \(e_2''\) such that
\begin{itemize}
\item if \([\seq{v}/(\seq{x},x)]e_2'' \redswith{\epsilon}{} \FAIL\), then 
\([\Dup{\seq{v}}{j}/(\seq{x},x)]e_2' \redswith{\epsilon}{} \FAIL\) and
\item if \([\seq{v}/(\seq{x},x)]e_2'' \redswith{\epsilon}{} f_i\ \seq{v}'\), then 
\([\Dup{\seq{v}}{j}/(\seq{x},x)]e_2' \redswith{\epsilon}{}\geq \Copy{f_i}{j}\ \Dup{(\Pi_{i,j}\seq{v}')}{j+1}\).
\end{itemize}
By \rn{A-Let}, we get
\(\T{\NAT{\Gamma},\seq{x}:\NAT{\seq{\sigma}}}{e}{\TUNIT}{e_2}\), where
\(e_2=\LETEQIN{x}{e_1'}e_2''\).
Thus, we obtain
\begin{itemize}
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} \FAIL\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x}]e_2 \redswith{\epsilon}{} f_i\ \seq{v}'\), then 
\([\Dup{\seq{v}}{j}/\seq{x}]e_1 \redswith{\epsilon}{}\geq \Copy{f_i}{j}\ \Dup{(\Pi_{i,j}\seq{v}')}{j+1}\).
\end{itemize}
\end{itemize}
\end{pfof}

\subsection{Proof of Lemma~\protect\ref{lem:main}}
\label{sec:main}
%lem:main
%  lem:conv
%  lem:weakening
%  lem:merge
%lem:subenv
%  lem:weakening
%Theorem~\ref{thm:progress}
%  lem:main
%  lem:subenv

\begin{pfof}{Lemma~\ref{lem:main}}
Let \(\set{f_i\ \seq{x}_i=\PAR{e_{i,0}}{e_{i,1}}}_{i=1}^n = D_1\).
%
For each \(i \in \set{1,\dots,n}\) and \(k \in \set{0,1}\), let \(J_{i,k}\) be
\[
 J_{i,k}=\set{j \mid \mbox{the target of }j\mbox{th function ~call is }f_i \land b_j=k}.
\]
%
%For each \(i \in \set{1,\dots,n}\), \(k \in \set{0,1}\), and \(j \in J_{i,k}\), 
For each \(j \in \set{1,\dots,\ell}\), if \(j \in J_{i,k}\), then there 
exists \(e_j\) such that:
\begin{itemize}
\item \(\T{\Gamma,\seq{x}_i:\seq{\sigma}_{i,j}}{\X{e_{i,k}}{j+1}}{\TUNIT}{e_j}\) and
\item \(\Copy{f_i}{j}\ \seq{x}_i = e_j \in D_4\)
%\item otherwise, \(\T{\Gamma,\seq{x}_i:\seq{\sigma}_{i,j}}{\tuple{}}{\TUNIT}{e_j}\).
\end{itemize}
%
By Lemma~\ref{lem:conv},
%for each \(i \in \set{1,\dots,n}\), \(k \in \set{0,1}\), and \(j \in J_{i,k}\), 
for each \(j \in \set{1,\dots,\ell}\), if \(j \in J_{i,k}\), then there 
exists \(e_j'\) such that:
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}_i:\NAT{\seq{\sigma}_{i,j}}}{e_{i,k}}{\TUNIT}{e_j'}\), 
\item if \([\seq{v}/\seq{x}_i]e_j' \redswith{\epsilon}{} \FAIL\), then 
\([\Dup{\seq{v}}{j+1}/\seq{x}_i]e_j \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x}_i]e_j' \redswith{\epsilon}{} f_{i'}\ \seq{v}'\), then 
\begin{eqnarray*}
[\Dup{\seq{v}}{j+1}/\seq{x}_i]e_j \redswith{\epsilon}{}\geq \Copy{f_{i'}}{j+1}\ \Dup{(\Pi_{i',j+1} \seq{v}')}{j+2}.
\end{eqnarray*}
\end{itemize}
%
By Lemma~\ref{lem:weakening}, 
for each \(j \in \set{1,\dots,\ell}\), if \(j \in J_{i,k}\), then there 
exists \(e_j''\) such 
that:
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}_i:\NAT{\seq{\sigma}_{i,1}} \itlub \cdots 
\itlub \NAT{\seq{\sigma}_{i,\ell}}}{e_{i,k}}{\TUNIT}{e_j''}\),
\item if \([\seq{v}/\seq{x}_i]e_j'' \redswith{\epsilon}{} \FAIL\), then 
\([\Pi_{i,j} \seq{v}/\seq{x}_i]e_j' \redswith{\epsilon}{} \FAIL\), and
\item if \([\seq{v}/\seq{x}_i]e_j'' \redswith{\epsilon}{} f\ \seq{v}'\), then 
\([\Pi_{i,j} \seq{v}/\seq{x}_i]e_j' \redswith{\epsilon}{} f\ \seq{v}'\).
\end{itemize}
%
%emptyÇÃèÍçáÇ‡Ç†ÇÈ
By Lemma~\ref{lem:merge}, for each \(i \in \set{1,\dots,n}\) and \(k \in 
\set{0,1}\), there exists \(e_{i,k}'\) such that
\begin{itemize}
\item \(\T{\NAT{\Gamma},\seq{x}_i:\NAT{\seq{\sigma}_{i,1}} \itlub \cdots \itlub 
\NAT{\seq{\sigma}_{i,\ell}}}{e_{i,k}}{\TUNIT}{e_{i,k}'}\),
\item for each \(j \in J_{i,k}\), 
if \([\seq{v}/\seq{x}_i]e_{i,k}' \redswith{\epsilon}{} \FAIL\), then 
\([\seq{v}/\seq{x}_i]e_j'' \redswith{\epsilon}{} \FAIL\), and
\item for each \(j \in J_{i,k}\), 
if \([\seq{v}/\seq{x}_i]e_{i,k}' \redswith{\epsilon}{} f\ \seq{v}'\), then 
\([\seq{v}/\seq{x}_i]e_j'' \redswith{\epsilon}{}\geq f\ \seq{v}'\).
\end{itemize}
%
%%%Thus, we have
%%%\begin{eqnarray*}
%%%%\PAR{e_{i,0}'}{e_{i,1}'}
%%%%&\subseteq& e_{i,k}' \qquad \mbox{(for each \(k \in \set{0,1}\))} \\
%%%\X{e_{i,k}'}{j+1}
%%%\subseteq \X{e_j''}{j+1}
%%%\subseteq \X{e_j'}{j+1}
%%%\subseteq e_j \qquad \mbox{(for each \(j \in J_{i,k}\))}
%%%\end{eqnarray*}
%%%%
For each \(i \in \set{1,\dots,n}\), by \rn{A-Par}, we get 
\(\T{\NAT{\Gamma},\seq{x}_i:\NAT{\seq{\sigma}_{i,1}} 
\itlub \cdots \itlub 
\NAT{\seq{\sigma}_{i,\ell}}}{\PAR{e_{i,0}}{e_{i,1}}}{\TUNIT}{\PAR{e_{i,0}'} 
{e_{i,1}'}}\).
%
%Note that \(\PAR{e_{i,0}'}{e_{i,1}'} \subseteq e_{i,k}'\) for each \(k \in \set{0,1}\).
%
Let \(D_3=\set{f_i\ \seq{x}_i=\PAR{e_{i,0}'}{e_{i,1}'}}_{i=1}^n\).
Then, it follows that \(\T{}{D_1}{\NAT{\Gamma}}{D_3}\).
%
We now show that \(\textit{main}\tuple{} \not\redswith{s}{D_3} \FAIL\) 
by using proof by contradiction. Assume that \(\textit{main}\tuple{} 
\redswith{s}{D_3} \FAIL\). Then, we have the following error trace for some \(\seq{v}_1,\dots,\seq{v}_{\ell}\):
\begin{eqnarray*}
&&\textit{main}\tuple{}=f_{I_1}\ \seq{v}_1 \redswith{b_1}{D_3} [\seq{v}_1/\seq{x}_{I_1}]e_{I_1,b_1}' \redswith{}{D_3} f_{I_2}\ \seq{v}_2 \redswith{b_2}{D_3} \\
&& \cdots \redswith{}{D_3} f_{I_{\ell}}\ \seq{v}_{\ell} \redswith{b_{\ell}}{D_3} [\seq{v}_{\ell}/\seq{x}_{I_{\ell}}]e_{I_{\ell},b_{\ell}}' \redswith{}{D_3} \FAIL
\end{eqnarray*}
Here, \(f_{I_j}\) represents the target of \(j\)th function call.
%
%Since \(\X{e_{i_j,b_j}'}{j+1} \subseteq e_j\) for each \(j \in \set{1,\dots,\ell}\),
From the above trace, we obtain the following error trace:
\begin{eqnarray*}
&&\textit{main}\tuple{} \redswith{}{D_4} \Copy{\textit{main}}{1}\tuple{}= \\
&&f_{I_1}^{(1)}\ \Dup{(\Pi_{I_1,1} \seq{v}_1)}{2} \redswith{b_1}{D_4} [\Dup{(\Pi_{I_1,1} \seq{v}_1)}{2}/\seq{x}_{I_1}]e_1 \redswith{}{D_4}\geq \\
&&f_{I_2}^{(2)}\ \Dup{(\Pi_{I_2,2} \seq{v}_2)}{3} \redswith{b_2}{D_4} \cdots \redswith{}{D_4}\geq \\
&&f_{I_{\ell}}^{(\ell)}\ \Dup{(\Pi_{I_{\ell},\ell} \seq{v}_{\ell})}{\ell+1} \redswith{b_{\ell}}{D_4} [\Dup{(\Pi_{I_{\ell},\ell} \seq{v}_{\ell})}{\ell+1}/\seq{x}_{I_{\ell}}]e_{\ell} \redswith{}{D_4} \FAIL
\end{eqnarray*}
%
Thus, we get \(\textit{main}\tuple{} \redswith{}{D_4} \FAIL\), which 
contradicts to the assumption \(\textit{main}\tuple{} 
\not\redswith{}{D_4} \FAIL\).

%%
%We have that \(e_{I_j,b_j}'\) does not diverge for each 
%\(j=1,\dots,\ell\).
\end{pfof}

\begin{lemma}
\label{lem:subenv}
If \(\T{}{D}{\Gamma_1}{D_1}\) and \(\Gamma_1 \sqsubseteq \Gamma_2\), then there exists \(D_2\) such that
\(\T{}{D}{\Gamma_2}{D_2}\) and if \(\textit{main}\tuple{} \redswith{s}{D_2} \FAIL\), then \(\textit{main}\tuple{} \redswith{s}{D_1} \FAIL\).
%
Here, we write \(\Gamma \sqsubseteq \Gamma'\) if for all \(f \in 
\DOM{\Gamma}\), \(\Gamma(f)=\sigma\) implies \(\Gamma'(f)=\sigma'\) for 
some \(\sigma'\) such that \(\sigma \sqsubseteq \sigma'\).
\end{lemma}
\begin{proof}
A corollary of Lemma~\ref{lem:weakening}.
%Straightforward induction on the derivation of \(\T{}{D}{\Gamma_1}{D_1}\).
\end{proof}

\begin{pfof}{Theorem~\ref{thm:progress}}
We have some \(\Gamma_1\) such that \(\Delta \in \depty(\Gamma_1)\) and 
\(\NAT{\Gamma_1}=\RefAT(\emptyset,\Delta) \sqsubseteq \Gamma\). By 
Theorem~\ref{th:rel-complete}, we have \(D_4\) such that 
\(\T{}{D_2}{\Gamma_1}{D_4}\) and \(\textit{main}\tuple{} 
\not\redswith{}{D_4} \FAIL\). By Lemma~\ref{lem:main}, there exists \(D\) such that
\(\T{}{D_1}{\NAT{\Gamma_1}}{D}\) and
\(\textit{main}\tuple{} \not\redswith{s}{D} \FAIL\).
By Lemma~\ref{lem:subenv}, there exists \(D_3\) such that
\(\T{}{D_1}{\Gamma}{D_3}\) and
\(\textit{main}\tuple{} \not\redswith{s}{D_3} \FAIL\).
\end{pfof}
