\begin{figure}[tbp]
\paragraph{Syntax}
\[
\begin{array}{lcl}
%%\delta&::=&\rt{\nu}{b_1}{\psi} \mid \cdots \mid \rt{\nu}{b_n}{\psi} \mid x:\delta_1 \to \delta_2 \mid \bigwedge_{i\in S} \delta_i \\
\delta&::=&\rt{\nu}{b}{\psi} %%\mid \cdots \mid \rt{\nu}{b_n}{\psi} 
\mid \bigwedge_{i\in S}(x:\delta_{1,i} \to \delta_{2,i})\\
%%\Delta&::=&\emptyset \mid \Delta,\psi \mid \Delta,f:\delta \mid \Delta,x:\delta
\Delta&::=& \emptyset \mid \Delta,x:\delta
\end{array}
\]
%\koba{It seems we need an empty intersection \(\top = \bigwedge_{\set{i\in \emptyset}} \delta_i \).
%Consider \texttt{f\ g = fail}, where the simple type of \(f\) is \((\TUNIT\ra \TUNIT)\ra \TUNIT\).
%Then, \(f\) is only given a type \(\top\).}
\paragraph{Typing Rules}
\ 
\typicallabel{D-Assume}

\infrule[D-\(\land\)-Intro]
  {\DPT{\Delta}{e}{\delta_1} \andalso
   \DPT{\Delta}{e}{\delta_2}}
  {\DPT{\Delta}{e}{\delta_1 \land \delta_2}}
\rulesp

\infrule[D-\(\land\)-Elim]
  {\DPT{\Delta}{e}{\delta_1 \land \delta_2} \andalso
   i \in \set{1,2}}
  {\DPT{\Delta}{e}{\delta_i}}
\rulesp

%\infrule[D-Const]
%  {\mbox{\(c\) has the base type \(b\)}}
%  {\DPT{\Delta}{c}{\rt{\nu}{b}{\nu=c}}}
%\rulesp
%
%\infrule[D-Op]
%  {\alphaB(\Delta) \pS \OP(\seq{v}):b}
%  {\DPT{\Delta}{\OP(\seq{v})}{\rt{\nu}{b}{\nu=\OP(\seq{v})}}}
%\rulesp
%
%\infrule[D-Var]
%  {x:\rt{\nu}{b}{\psi} \in \Delta}
%  {\DPT{\Delta}{x}{\rt{\nu}{b}{\nu=x}}}
%\rulesp

\infrule[D-Base]
  {\mbox{$e$ is a constant, a variable or an expression of the form \(\OP(\seq{v})\)}\\
    \DtoS(\Delta) \pS e:b}
  {\DPT{\Delta}{e}{\rt{\nu}{b}{\nu=e}}}
\rulesp

\infrule[D-App]
  {\Delta(x)= (x_1\COL\delta_1 \to \cdots \to x_k\COL\delta_k \to\delta)\land \delta'\\
%%   \mbox{\(\Delta(x)\) is a function type} \\
   \DPT{\Delta}{v_i}{[v_1/x_1,\ldots,v_{i-1}/x_{i-1}]\delta_i} 
  \mbox{ (for each $i\in\set{1,\ldots,k}$)}}
  {\DPT{\Delta}{x\ \seq{v}}{[\seq{v}/\seq{x}]\delta}}
\rulesp

\infrule[D-Let]
  {\DPT{\Delta}{e_1}{\delta'} \andalso
   \DPT{\Delta,x:\delta'}{e_2}{\delta}}
  {\DPT{\Delta}{\LETEQIN{x}{e_1}{e_2}}{\delta}}
\rulesp


\infrule[D-Fail]
  {\models \SEM{\Delta} \IMPLY \FALSE}
  {\DPT{\Delta}{\FAIL}{\delta}}
\rulesp

\infrule[D-Assume]
  {\DPT{\Delta}{v}{\TBOOL} \andalso
   \DPT{\Delta,x\COL \set{\nu:\TUNIT \mid v}}{e}{\delta}}
  {\DPT{\Delta}{\ASSUME{v}{e}}{\delta}}
\rulesp

\infrule[D-Par]
  {\DPT{\Delta}{e_1}{\delta} \andalso
   \DPT{\Delta}{e_2}{\delta}}
  {\DPT{\Delta}{\PAR{e_1}{e_2}}{\delta}}
\rulesp

%%%\infrule[D-Coerce]
%%%  {\DPT{\Delta}{e}{\rt{\nu}{b}{\psi'}} \andalso
%%%   \models \SEM{\Delta} \land \psi' \IMPLY \psi}
%%%  {\DPT{\Delta}{e}{\rt{\nu}{b}{\psi}}}
%%%
%%%\koba{How about subtyping on functions?}

\infrule[D-Coerce]
  {\DPT{\Delta}{e}{\delta}\andalso \Delta \p \delta\subT \delta'}
  {\DPT{\Delta}{e}{\delta'}}
\rulesp

\infrule[D-Prog]
  {f_i: (\seq{x}_i:\seq{\delta}_i \to \delta_i) \in \Delta \andalso
   \DPT{\Delta,\seq{x}_i:\seq{\delta}_i}{e_i}{\delta_i} \\
   (\mbox{for each \(i \in \set{i=1,\dots,m}\)}) \\
   \Gamma(\textit{main})=\rtbase{\nu}{\TUNIT}{\TRUE} \to \rtbase{\nu}{\TUNIT}{\TRUE}}
  {\DPT{}{\set{f_1\ \seq{x}_1 = e_1,\ldots,f_m\ \seq{x}_m = e_m}}{\Delta}}
\rulesp

\infrule[Sub-Base]
  {\models \SEM{\Delta} \land \psi \IMPLY \psi'}
  {\DPSUB{\Delta}{\rt{\nu}{b}{\psi}\subT \rt{\nu}{b}{\psi'}}}
\rulesp

\infrule[Sub-Fun]
  {\DPSUB{\Delta}{\delta_1'\subT \delta_1}\andalso
   \DPSUB{\Delta,x\COL \delta'_1}{\delta_2\subT \delta'_2}}
  {\DPSUB{\Delta}{(x\COL\delta_1\to \delta_2)\subT (x\COL\delta'_1\to \delta'_2)}}
\rulesp

\infrule[Sub-IT1]
  {\forall i'\in\set{1,\ldots,m'}.\exists i\in\set{1,\ldots,m}.\DPSUB{\Delta}{\delta_i\subT \delta'_{i'}}}
  {\DPSUB{\Delta}{\dtI_{i\in\set{1,\ldots,m}} \delta_i \subT\dtI_{i\in\set{1,\ldots,m'}} \delta'_i}}

\begin{eqnarray*}
%\SEM{\Delta,\psi}&=&\SEM{\Delta} \land \psi \\
%%\SEM{\Delta,f:\delta}&=&\SEM{\Delta} \\
\SEM{\Delta,x:\set{\nu:b \mid \psi}}&=&\SEM{\Delta} \land [x/\nu]\psi \\
\SEM{\Delta,x:\bigwedge_{i\in S}(\nu:\delta_{i1} \to \delta_{i2})}&=&\SEM{\Delta}
\end{eqnarray*}
\caption{Dependent Intersection Type System}
\label{fig:dep_rules}
\end{figure}
