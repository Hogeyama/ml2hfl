# The script generated by autoconf from this input will set the following
# variables:
#   OCAMLLEX      "ocamllex" (or "ocamllex.opt" if present)
#   OCAMLYACC     "ocamlyac"

# check for one particular file of the sources
# ADAPT THE FOLLOWING LINE TO YOUR SOURCES!
AC_INIT(util.ml)

# we first look for ocamlfind
AC_CHECK_PROG(OCAMLFIND,ocamlfind,ocamlfind,no)
if test "$OCAMLFIND" = no ; then
    AC_MSG_ERROR(Cannot find ocamlfind)
else
    echo "ocamlfind detected"
    OCAMLLIB=`ocamlfind query stdlib | tr -d '\\r'`

    EXTLIB=`ocamlfind query extlib | tr -d '\\r'`
    if test $EXTLIB; then
        echo "extlib detected"
    else
        AC_MSG_ERROR(Cannot find extlib)
    fi

    ZARITH=`ocamlfind query zarith | tr -d '\\r'`
    if test $ZARITH; then
        echo "zarith detected"
    else
        AC_MSG_ERROR(Cannot find zarith)
    fi

    CAMLP4=`ocamlfind query camlp4 | tr -d '\\r'`
    if test $CAMLP4; then
        echo "camlp4 detected"
    else
        AC_MSG_ERROR(Cannot find camlp4)
    fi

    CAMLP5=`ocamlfind query camlp5 | tr -d '\\r'`
    if test $CAMLP5; then
        echo "camlp5 detected"
    else
        AC_MSG_ERROR(Cannot find camlp5)
    fi
fi

# we extract OCaml version number
OCAMLVERSION=`$OCAMLFIND ocamlc -v | sed -n -e 's|.*version *\(.*\)$|\1|p' `
echo "ocaml version is $OCAMLVERSION"

# ocamllex and ocamlyacc should also be present in the path
AC_CHECK_PROG(OCAMLLEX,ocamllex,ocamllex,no)
if test "$OCAMLLEX" = no ; then
    AC_MSG_ERROR(Cannot find ocamllex.)
else
    AC_CHECK_PROG(OCAMLLEXDOTOPT,ocamllex.opt,ocamllex.opt,no)
    if test "$OCAMLLEXDOTOPT" != no ; then
        OCAMLLEX=$OCAMLLEXDOTOPT
    fi
fi

AC_CHECK_PROG(OCAMLYACC,ocamlyacc,ocamlyacc,no)
if test "$OCAMLYACC" = no ; then
    AC_MSG_ERROR(Cannot find ocamlyacc.)
fi

AC_CHECK_PROG(CC,gcc,gcc,no)
if test "$CC" = no ; then
    AC_MSG_ERROR(Cannot find gcc.)
fi

AC_CHECK_PROG(CXX,g++,g++,no)
if test "$CXX" = no ; then
    AC_MSG_ERROR(Cannot find g++.)
fi

AC_CHECK_PROG(CLANG,clang,clang,no)
if test "$CLANG" = no ; then
    AC_MSG_WARN(Cannot find clang.)
fi

AC_CHECK_PROG(GIT,git,git,no)
if test "$GIT" = no ; then
    AC_MSG_WARN(Cannot find git.)
fi

AC_ARG_ENABLE(ocaml, [  --disable-ocaml disable OCaml compiler-libs],,enable_ocaml=yes)
AC_MSG_CHECKING(whether to enable OCaml compiler-libs)
COMPLIBS=`ocamlfind query compiler-libs`
if test x$enable_ocaml = xyes && test $COMPLIBS; then
  AC_MSG_RESULT(yes)
  ENABLE_COMPLIBS=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(graphics, [  --disable-graphics disable OCaml graphics],,enable_graphics=yes)
AC_MSG_CHECKING(whether to enable OCaml graphics)
GRAPHICS=`ocamlfind query graphics`
if test x$enable_graphics = xyes && test $GRAPHICS; then
  AC_MSG_RESULT(yes)
  ENABLE_GRAPHICS=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(cvc3, [  --disable-cvc3 disable CVC3],,enable_cvc3=yes)
AC_MSG_CHECKING(whether to enable CVC3)
if test x$enable_cvc3 = xyes; then
  AC_MSG_RESULT(yes)
  ENABLE_CVC3=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(z3, [  --disable-z3 disable Z3],,enable_z3=yes)
AC_MSG_CHECKING(whether to enable Z3)
Z3=`ocamlfind query Z3`
if test x$enable_z3 = xyes && test $Z3; then
  AC_MSG_RESULT(yes)
  ENABLE_Z3=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(csisat, [  --disable-csisat disable CSIsat],,enable_csisat=yes)
AC_MSG_CHECKING(whether to enable CSIsat)
if test x$enable_csisat = xyes; then
  AC_MSG_RESULT(yes)
  ENABLE_CSISAT=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(minisat, [  --disable-minisat disable MiniSat],,enable_minisat=no)
AC_MSG_CHECKING(whether to enable MiniSat)
if test x$enable_minisat = xyes; then
  AC_MSG_RESULT(yes)
  ENABLE_MINISAT=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(rsrefine, [  --enable-rsrefine enable RSRefine],,enable_rsrefine=no)
AC_MSG_CHECKING(whether to enable RSRefine)
if test x$enable_rsrefine = xyes; then
  AC_MSG_RESULT(yes)
  ENABLE_RSREFINE=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(aisat, [  --enable-aisat enable aiSat],,enable_aisat=no)
AC_MSG_CHECKING(whether to enable aiSat)
if test x$enable_aisat = xyes; then
  AC_MSG_RESULT(yes)
  ENABLE_AISAT=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(glpk, [  --disable-glpk disable GLPK],,enable_glpk=yes)
AC_MSG_CHECKING(whether to enable GLPK)
GLPK=`ocamlfind query glpk`
if test x$enable_glpk = xyes && test $GLPK; then
  AC_MSG_RESULT(yes)
  ENABLE_GLPK=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(csdp, [  --disable-csdp disable CSDP],,enable_csdp=yes)
AC_MSG_CHECKING(whether to enable CSDP)
CSDP=`ocamlfind query osdp`
if test x$enable_csdp = xyes && test $CSDP; then
  AC_MSG_RESULT(yes)
  ENABLE_CSDP=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(gsl, [  --disable-gsl disable GSL],,enable_gsl=yes)
AC_MSG_CHECKING(whether to enable GSL)
GSL=`ocamlfind query gsl`
if test x$enable_gsl = xyes && test $GSL; then
  AC_MSG_RESULT(yes)
  ENABLE_GSL=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(sppoc, [  --enable-sppoc enable SPPoC],,enable_sppoc=no)
AC_MSG_CHECKING(whether to enable SPPoC)
if test x$enable_sppoc = xyes; then
  AC_MSG_RESULT(yes)
  ENABLE_SPPOC=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(atp, [  --disable-atp disable ATP],,enable_atp=yes)
AC_MSG_CHECKING(whether to enable ATP)
if test x$enable_atp = xyes; then
  AC_MSG_RESULT(yes)
  ENABLE_ATP=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(apron, [  --disable-apron disable APRON],,enable_apron=yes)
AC_MSG_CHECKING(whether to enable APRON)
APRON=`ocamlfind query apron`
if test x$enable_apron = xyes && test $APRON; then
  AC_MSG_RESULT(yes)
  ENABLE_APRON=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(cil, [  --disable-cil disable CIL],,enable_cil=yes)
AC_MSG_CHECKING(whether to enable CIL)
CIL=`ocamlfind query cil`
if test x$enable_cil = xyes && test $CIL; then
  AC_MSG_RESULT(yes)
  ENABLE_CIL=1
else
  AC_MSG_RESULT(no)
fi

AC_ARG_ENABLE(llvm, [  --disable-llvm disable LLVM],,enable_llvm=yes)
AC_MSG_CHECKING(whether to enable LLVM)
LLVM=`ocamlfind query llvm`
if test x$enable_llvm = xyes && test $LLVM; then
  AC_MSG_RESULT(yes)
  ENABLE_LLVM=1
else
  AC_MSG_RESULT(no)
fi

# substitutions to perform
AC_SUBST(OCAMLLEX)
AC_SUBST(OCAMLYACC)
AC_SUBST(OCAMLLIB)
AC_SUBST(CC)
AC_SUBST(CLANG)
AC_SUBST(GIT)

AC_SUBST(ENABLE_COMPLIBS)
AC_SUBST(ENABLE_GRAPHICS)
AC_SUBST(ENABLE_CVC3)
AC_SUBST(ENABLE_Z3)
AC_SUBST(ENABLE_CSISAT)
AC_SUBST(ENABLE_MINISAT)
AC_SUBST(ENABLE_RSREFINE)
AC_SUBST(ENABLE_AISAT)
AC_SUBST(ENABLE_GLPK)
AC_SUBST(ENABLE_CSDP)
AC_SUBST(ENABLE_GSL)
AC_SUBST(ENABLE_SPPOC)
AC_SUBST(ENABLE_ATP)
AC_SUBST(ENABLE_APRON)
AC_SUBST(ENABLE_CIL)
AC_SUBST(ENABLE_LLVM)

# Finally create the Makefile from Makefile.in
AC_OUTPUT(Makefile)
chmod a-w Makefile
